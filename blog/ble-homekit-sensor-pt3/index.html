<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.f628065b851287e306e5.css">@font-face{font-family:IBM Plex Sans;font-style:normal;font-display:swap;font-weight:100;src:local("IBM Plex Sans Thin "),local("IBM Plex Sans-Thin"),url(/static/ibm-plex-sans-latin-100-245539db8ee56425757ef728eda8194e.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-100-9a582f3a304f421eca4027517706843c.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:italic;font-display:swap;font-weight:100;src:local("IBM Plex Sans Thin italic"),local("IBM Plex Sans-Thinitalic"),url(/static/ibm-plex-sans-latin-100italic-3c34cf080b38f5fb1d4c59ffa45b3967.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-100italic-1ea7c5d21b5956b602bdf9656cfb353f.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:normal;font-display:swap;font-weight:200;src:local("IBM Plex Sans Extra Light "),local("IBM Plex Sans-Extra Light"),url(/static/ibm-plex-sans-latin-200-bf72c8412ab06c393f52efc5beb26ea7.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-200-67524c36348a323f78f2845e3aafc2d4.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:italic;font-display:swap;font-weight:200;src:local("IBM Plex Sans Extra Light italic"),local("IBM Plex Sans-Extra Lightitalic"),url(/static/ibm-plex-sans-latin-200italic-bbc2d55223638ce450424a917e1104b2.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-200italic-52df25607ec284ca361ae50ba24b3580.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:normal;font-display:swap;font-weight:300;src:local("IBM Plex Sans Light "),local("IBM Plex Sans-Light"),url(/static/ibm-plex-sans-latin-300-9e1c48af24191f6ea8aede14957c5d01.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-300-10bb6a0ae6dc8000d999ab622a45e281.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:italic;font-display:swap;font-weight:300;src:local("IBM Plex Sans Light italic"),local("IBM Plex Sans-Lightitalic"),url(/static/ibm-plex-sans-latin-300italic-c76f2ab53673e964b6e6734c1c455761.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-300italic-d3566d5bb4f31d86bfb9fda09563b416.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:normal;font-display:swap;font-weight:400;src:local("IBM Plex Sans Regular "),local("IBM Plex Sans-Regular"),url(/static/ibm-plex-sans-latin-400-263d6267533501f58c33b12b382e3abb.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-400-a2c56f946488a9a267ba6ba21471a217.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:italic;font-display:swap;font-weight:400;src:local("IBM Plex Sans Regular italic"),local("IBM Plex Sans-Regularitalic"),url(/static/ibm-plex-sans-latin-400italic-89a93a1bdde48c7bb104150de88affce.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-400italic-272f86114c980c52c131dfc3b4ae3276.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:normal;font-display:swap;font-weight:500;src:local("IBM Plex Sans Medium "),local("IBM Plex Sans-Medium"),url(/static/ibm-plex-sans-latin-500-0866c24487514ad726738fb24f8e015b.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-500-f6d5c5d5b849796d6a8f5a2953b60753.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:italic;font-display:swap;font-weight:500;src:local("IBM Plex Sans Medium italic"),local("IBM Plex Sans-Mediumitalic"),url(/static/ibm-plex-sans-latin-500italic-ffd12d59339823b8cf53b9f99b47d87c.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-500italic-ccd41bd1a5bfa8bad2cd8d35fdaeb3d1.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:normal;font-display:swap;font-weight:600;src:local("IBM Plex Sans SemiBold "),local("IBM Plex Sans-SemiBold"),url(/static/ibm-plex-sans-latin-600-7852d4dc26ef44df58e23dc0b9722d6f.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-600-337b16517a230dc830b84dc6e6167b68.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:italic;font-display:swap;font-weight:600;src:local("IBM Plex Sans SemiBold italic"),local("IBM Plex Sans-SemiBolditalic"),url(/static/ibm-plex-sans-latin-600italic-17e5379fd9a99b9bcb26ea983f391b6a.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-600italic-6f4ba6aa87fa99d5bc2b90a7b40a0ded.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:normal;font-display:swap;font-weight:700;src:local("IBM Plex Sans Bold "),local("IBM Plex Sans-Bold"),url(/static/ibm-plex-sans-latin-700-c9983d3d04f3ed6c2eafee1db1d24e06.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-700-b8809d619a33eb825b0450281ff752e7.woff) format("woff")}@font-face{font-family:IBM Plex Sans;font-style:italic;font-display:swap;font-weight:700;src:local("IBM Plex Sans Bold italic"),local("IBM Plex Sans-Bolditalic"),url(/static/ibm-plex-sans-latin-700italic-02954beec9e742bb1f3ae27b7e7cb71f.woff2) format("woff2"),url(/static/ibm-plex-sans-latin-700italic-72e9af409ddafc63a5dd380e34758560.woff) format("woff")}</style><meta name="generator" content="Gatsby 2.26.1"/><link rel="alternate" type="application/rss+xml" title="Minimal Blog - @lekoarts/gatsby-theme-minimal-blog" href="/rss.xml"/><title data-react-helmet="true">Building a battery-powered wireless sensor using Bluetooth Low-Energy (BLE) and Apple HomeKit (Part 3) | Daniel P. Gross</title><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><meta data-react-helmet="true" name="description" content="This is the third post in a series about building a simple wireless temperature and humidity sensor using inexpensive components, Bluetooth…"/><meta data-react-helmet="true" name="image" content="https://dgross.ca/banner.jpg"/><meta data-react-helmet="true" property="og:title" content="Building a battery-powered wireless sensor using Bluetooth Low-Energy (BLE) and Apple HomeKit (Part 3)"/><meta data-react-helmet="true" property="og:url" content="https://dgross.ca/blog/ble-homekit-sensor-pt3"/><meta data-react-helmet="true" property="og:description" content="This is the third post in a series about building a simple wireless temperature and humidity sensor using inexpensive components, Bluetooth…"/><meta data-react-helmet="true" property="og:image" content="https://dgross.ca/banner.jpg"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image:alt" content="This is the third post in a series about building a simple wireless temperature and humidity sensor using inexpensive components, Bluetooth…"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="Building a battery-powered wireless sensor using Bluetooth Low-Energy (BLE) and Apple HomeKit (Part 3)"/><meta data-react-helmet="true" name="twitter:url" content="https://dgross.ca/blog/ble-homekit-sensor-pt3"/><meta data-react-helmet="true" name="twitter:description" content="This is the third post in a series about building a simple wireless temperature and humidity sensor using inexpensive components, Bluetooth…"/><meta data-react-helmet="true" name="twitter:image" content="https://dgross.ca/banner.jpg"/><meta data-react-helmet="true" name="twitter:image:alt" content="This is the third post in a series about building a simple wireless temperature and humidity sensor using inexpensive components, Bluetooth…"/><meta data-react-helmet="true" name="twitter:creator" content="@danielpgross"/><meta data-react-helmet="true" name="gatsby-theme" content="@lekoarts/gatsby-theme-minimal-blog"/><link as="script" rel="preload" href="/webpack-runtime-0b36765783ddb57012e0.js"/><link as="script" rel="preload" href="/framework-beda7bde9d7dca0755ce.js"/><link as="script" rel="preload" href="/1bfc9850-ae6f6e854d81acd9ae43.js"/><link as="script" rel="preload" href="/app-61629059a767a2c5dd4b.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/aed2e917f30c051bccba91aa15989a75fd0bd633-7af1ba497f02303e5a48.js"/><link as="script" rel="preload" href="/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-82ea993409075bcdefe9.js"/><link as="fetch" rel="preload" href="/page-data/blog/ble-homekit-sensor-pt3/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3090400250.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3090400250.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/318001574.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.body.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion-css="9096aj">body{--theme-ui-colors-transparent:var(--theme-ui-colors-transparent,transparent);--theme-ui-colors-black:var(--theme-ui-colors-black,#000);--theme-ui-colors-white:var(--theme-ui-colors-white,#fff);--theme-ui-colors-gray-0:var(--theme-ui-colors-gray-0,null);--theme-ui-colors-gray-1:var(--theme-ui-colors-gray-1,#f7fafc);--theme-ui-colors-gray-2:var(--theme-ui-colors-gray-2,#edf2f7);--theme-ui-colors-gray-3:var(--theme-ui-colors-gray-3,#e2e8f0);--theme-ui-colors-gray-4:var(--theme-ui-colors-gray-4,#cbd5e0);--theme-ui-colors-gray-5:var(--theme-ui-colors-gray-5,#a0aec0);--theme-ui-colors-gray-6:var(--theme-ui-colors-gray-6,#718096);--theme-ui-colors-gray-7:var(--theme-ui-colors-gray-7,#4a5568);--theme-ui-colors-gray-8:var(--theme-ui-colors-gray-8,#2d3748);--theme-ui-colors-gray-9:var(--theme-ui-colors-gray-9,#1a202c);--theme-ui-colors-red-0:var(--theme-ui-colors-red-0,null);--theme-ui-colors-red-1:var(--theme-ui-colors-red-1,#fff5f5);--theme-ui-colors-red-2:var(--theme-ui-colors-red-2,#fed7d7);--theme-ui-colors-red-3:var(--theme-ui-colors-red-3,#feb2b2);--theme-ui-colors-red-4:var(--theme-ui-colors-red-4,#fc8181);--theme-ui-colors-red-5:var(--theme-ui-colors-red-5,#f56565);--theme-ui-colors-red-6:var(--theme-ui-colors-red-6,#e53e3e);--theme-ui-colors-red-7:var(--theme-ui-colors-red-7,#c53030);--theme-ui-colors-red-8:var(--theme-ui-colors-red-8,#9b2c2c);--theme-ui-colors-red-9:var(--theme-ui-colors-red-9,#742a2a);--theme-ui-colors-orange-0:var(--theme-ui-colors-orange-0,null);--theme-ui-colors-orange-1:var(--theme-ui-colors-orange-1,#fffaf0);--theme-ui-colors-orange-2:var(--theme-ui-colors-orange-2,#feebc8);--theme-ui-colors-orange-3:var(--theme-ui-colors-orange-3,#fbd38d);--theme-ui-colors-orange-4:var(--theme-ui-colors-orange-4,#f6ad55);--theme-ui-colors-orange-5:var(--theme-ui-colors-orange-5,#ed8936);--theme-ui-colors-orange-6:var(--theme-ui-colors-orange-6,#dd6b20);--theme-ui-colors-orange-7:var(--theme-ui-colors-orange-7,#c05621);--theme-ui-colors-orange-8:var(--theme-ui-colors-orange-8,#9c4221);--theme-ui-colors-orange-9:var(--theme-ui-colors-orange-9,#7b341e);--theme-ui-colors-yellow-0:var(--theme-ui-colors-yellow-0,null);--theme-ui-colors-yellow-1:var(--theme-ui-colors-yellow-1,#fffff0);--theme-ui-colors-yellow-2:var(--theme-ui-colors-yellow-2,#fefcbf);--theme-ui-colors-yellow-3:var(--theme-ui-colors-yellow-3,#faf089);--theme-ui-colors-yellow-4:var(--theme-ui-colors-yellow-4,#f6e05e);--theme-ui-colors-yellow-5:var(--theme-ui-colors-yellow-5,#ecc94b);--theme-ui-colors-yellow-6:var(--theme-ui-colors-yellow-6,#d69e2e);--theme-ui-colors-yellow-7:var(--theme-ui-colors-yellow-7,#b7791f);--theme-ui-colors-yellow-8:var(--theme-ui-colors-yellow-8,#975a16);--theme-ui-colors-yellow-9:var(--theme-ui-colors-yellow-9,#744210);--theme-ui-colors-green-0:var(--theme-ui-colors-green-0,null);--theme-ui-colors-green-1:var(--theme-ui-colors-green-1,#f0fff4);--theme-ui-colors-green-2:var(--theme-ui-colors-green-2,#c6f6d5);--theme-ui-colors-green-3:var(--theme-ui-colors-green-3,#9ae6b4);--theme-ui-colors-green-4:var(--theme-ui-colors-green-4,#68d391);--theme-ui-colors-green-5:var(--theme-ui-colors-green-5,#48bb78);--theme-ui-colors-green-6:var(--theme-ui-colors-green-6,#38a169);--theme-ui-colors-green-7:var(--theme-ui-colors-green-7,#2f855a);--theme-ui-colors-green-8:var(--theme-ui-colors-green-8,#276749);--theme-ui-colors-green-9:var(--theme-ui-colors-green-9,#22543d);--theme-ui-colors-teal-0:var(--theme-ui-colors-teal-0,null);--theme-ui-colors-teal-1:var(--theme-ui-colors-teal-1,#e6fffa);--theme-ui-colors-teal-2:var(--theme-ui-colors-teal-2,#b2f5ea);--theme-ui-colors-teal-3:var(--theme-ui-colors-teal-3,#81e6d9);--theme-ui-colors-teal-4:var(--theme-ui-colors-teal-4,#4fd1c5);--theme-ui-colors-teal-5:var(--theme-ui-colors-teal-5,#38b2ac);--theme-ui-colors-teal-6:var(--theme-ui-colors-teal-6,#319795);--theme-ui-colors-teal-7:var(--theme-ui-colors-teal-7,#2c7a7b);--theme-ui-colors-teal-8:var(--theme-ui-colors-teal-8,#285e61);--theme-ui-colors-teal-9:var(--theme-ui-colors-teal-9,#234e52);--theme-ui-colors-blue-0:var(--theme-ui-colors-blue-0,null);--theme-ui-colors-blue-1:var(--theme-ui-colors-blue-1,#ebf8ff);--theme-ui-colors-blue-2:var(--theme-ui-colors-blue-2,#bee3f8);--theme-ui-colors-blue-3:var(--theme-ui-colors-blue-3,#90cdf4);--theme-ui-colors-blue-4:var(--theme-ui-colors-blue-4,#63b3ed);--theme-ui-colors-blue-5:var(--theme-ui-colors-blue-5,#4299e1);--theme-ui-colors-blue-6:var(--theme-ui-colors-blue-6,#3182ce);--theme-ui-colors-blue-7:var(--theme-ui-colors-blue-7,#2b6cb0);--theme-ui-colors-blue-8:var(--theme-ui-colors-blue-8,#2c5282);--theme-ui-colors-blue-9:var(--theme-ui-colors-blue-9,#2a4365);--theme-ui-colors-indigo-0:var(--theme-ui-colors-indigo-0,null);--theme-ui-colors-indigo-1:var(--theme-ui-colors-indigo-1,#ebf4ff);--theme-ui-colors-indigo-2:var(--theme-ui-colors-indigo-2,#c3dafe);--theme-ui-colors-indigo-3:var(--theme-ui-colors-indigo-3,#a3bffa);--theme-ui-colors-indigo-4:var(--theme-ui-colors-indigo-4,#7f9cf5);--theme-ui-colors-indigo-5:var(--theme-ui-colors-indigo-5,#667eea);--theme-ui-colors-indigo-6:var(--theme-ui-colors-indigo-6,#5a67d8);--theme-ui-colors-indigo-7:var(--theme-ui-colors-indigo-7,#4c51bf);--theme-ui-colors-indigo-8:var(--theme-ui-colors-indigo-8,#434190);--theme-ui-colors-indigo-9:var(--theme-ui-colors-indigo-9,#3c366b);--theme-ui-colors-purple-0:var(--theme-ui-colors-purple-0,null);--theme-ui-colors-purple-1:var(--theme-ui-colors-purple-1,#faf5ff);--theme-ui-colors-purple-2:var(--theme-ui-colors-purple-2,#e9d8fd);--theme-ui-colors-purple-3:var(--theme-ui-colors-purple-3,#d6bcfa);--theme-ui-colors-purple-4:var(--theme-ui-colors-purple-4,#b794f4);--theme-ui-colors-purple-5:var(--theme-ui-colors-purple-5,#9f7aea);--theme-ui-colors-purple-6:var(--theme-ui-colors-purple-6,#805ad5);--theme-ui-colors-purple-7:var(--theme-ui-colors-purple-7,#6b46c1);--theme-ui-colors-purple-8:var(--theme-ui-colors-purple-8,#553c9a);--theme-ui-colors-purple-9:var(--theme-ui-colors-purple-9,#44337a);--theme-ui-colors-pink-0:var(--theme-ui-colors-pink-0,null);--theme-ui-colors-pink-1:var(--theme-ui-colors-pink-1,#fff5f7);--theme-ui-colors-pink-2:var(--theme-ui-colors-pink-2,#fed7e2);--theme-ui-colors-pink-3:var(--theme-ui-colors-pink-3,#fbb6ce);--theme-ui-colors-pink-4:var(--theme-ui-colors-pink-4,#f687b3);--theme-ui-colors-pink-5:var(--theme-ui-colors-pink-5,#ed64a6);--theme-ui-colors-pink-6:var(--theme-ui-colors-pink-6,#d53f8c);--theme-ui-colors-pink-7:var(--theme-ui-colors-pink-7,#b83280);--theme-ui-colors-pink-8:var(--theme-ui-colors-pink-8,#97266d);--theme-ui-colors-pink-9:var(--theme-ui-colors-pink-9,#702459);--theme-ui-colors-grayDark:var(--theme-ui-colors-grayDark,#2d3748);--theme-ui-colors-text:var(--theme-ui-colors-text,#2d3748);--theme-ui-colors-background:var(--theme-ui-colors-background,#fff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#2b6cb0);--theme-ui-colors-primaryHover:var(--theme-ui-colors-primaryHover,#2c5282);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#718096);--theme-ui-colors-muted:var(--theme-ui-colors-muted,#e2e8f0);--theme-ui-colors-success:var(--theme-ui-colors-success,#9ae6b4);--theme-ui-colors-info:var(--theme-ui-colors-info,#63b3ed);--theme-ui-colors-warning:var(--theme-ui-colors-warning,#faf089);--theme-ui-colors-danger:var(--theme-ui-colors-danger,#feb2b2);--theme-ui-colors-light:var(--theme-ui-colors-light,#f7fafc);--theme-ui-colors-dark:var(--theme-ui-colors-dark,#2d3748);--theme-ui-colors-textMuted:var(--theme-ui-colors-textMuted,#718096);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-toggleIcon,#2d3748);--theme-ui-colors-heading:var(--theme-ui-colors-heading,#000);--theme-ui-colors-divide:var(--theme-ui-colors-divide,#cbd5e0);color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,#cbd5e0);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#63b3ed);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#7f8ea3);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-modes-dark-toggleIcon,#cbd5e0);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#1A202C);--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#fff);--theme-ui-colors-divide:var(--theme-ui-colors-modes-dark-divide,#2d3748);--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,#2d3748);}</style><style data-emotion-css="tm2q0o">*{box-sizing:border-box;}body{margin:0;font-family:"IBM Plex Sans",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="kcr4c7">*{box-sizing:inherit;}html{-webkit-text-size-adjust:100%;}img{border-style:none;}pre{font-family:monospace;font-size:1em;}[hidden]{display:none;}::selection{background-color:var(--theme-ui-colors-text,#2d3748);color:var(--theme-ui-colors-background,#fff);}a{-webkit-transition:all 0.3s ease-in-out;transition:all 0.3s ease-in-out;color:text;}</style><style data-emotion-css="1g597hz">.css-1g597hz{border:0;-webkit-clip:react(0 0 0 0);clip:react(0 0 0 0);height:1px;width:1px;margin:-1px;padding:0;overflow:hidden;position:absolute;}.css-1g597hz:focus{padding:1rem;position:fixed;top:15px;left:15px;background-color:var(--theme-ui-colors-heading,#000);color:var(--theme-ui-colors-background,#fff);z-index:1;width:auto;height:auto;-webkit-clip:auto;clip:auto;-webkit-text-decoration:none;text-decoration:none;}</style><a href="#skip-nav" data-skip-link="true" class="css-1g597hz">Skip to content</a><style data-emotion-css="1jrqzhj">.css-1jrqzhj{box-sizing:border-box;margin:0;min-width:0;width:100%;max-width:container;margin-left:auto;margin-right:auto;padding:1rem;max-width:1024px;}@media screen and (min-width:640px){.css-1jrqzhj{padding:2rem;}}</style><div class="css-1jrqzhj"><style data-emotion-css="hqxvh2">.css-hqxvh2{margin-bottom:1rem;border-bottom-width:1px;border-bottom-color:var(--theme-ui-colors-divide,#cbd5e0);border-bottom-style:solid;}@media screen and (min-width:640px){.css-hqxvh2{margin-bottom:2rem;}}</style><header class="css-hqxvh2"><style data-emotion-css="zcxndt">.css-zcxndt{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="10nf7hq">.css-10nf7hq{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-10nf7hq"><style data-emotion-css="dz3ojy">.css-dz3ojy{color:var(--theme-ui-colors-heading,#000);-webkit-text-decoration:none;text-decoration:none;}</style><a aria-label="Daniel P. Gross - Back to home" class="css-dz3ojy" href="/"><style data-emotion-css="zhfaww">.css-zhfaww{margin-top:0;margin-bottom:0;font-weight:500;font-size:1.3rem;}@media screen and (min-width:640px){.css-zhfaww{font-size:1.6rem;}}</style><div class="css-zhfaww">Daniel P. Gross</div></a><style data-emotion-css="i9gxme">.css-i9gxme{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="css-i9gxme"></div><style data-emotion-css="1iqi2nv">.css-1iqi2nv{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-top:1rem;margin-right:1rem;padding-bottom:1rem;color:var(--theme-ui-colors-secondary,#718096);-webkit-flex-flow:wrap;-ms-flex-flow:wrap;flex-flow:wrap;}.css-1iqi2nv a{color:var(--theme-ui-colors-secondary,#718096);}.css-1iqi2nv a:hover{color:var(--theme-ui-colors-heading,#000);}</style><div class="css-1iqi2nv"><style data-emotion-css="nrb238">.css-nrb238{font-size:1rem;}.css-nrb238 a:not(:last-of-type){margin-right:1rem;}@media screen and (min-width:640px){.css-nrb238{font-size:18px;}}.css-nrb238 .active{color:var(--theme-ui-colors-heading,#000);}</style><nav class="css-nrb238"><style data-emotion-css="1y5zoos">.css-1y5zoos{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#2b6cb0);-webkit-text-decoration:none;text-decoration:none;}.css-1y5zoos:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a class="css-1y5zoos" href="/">Home</a><a class="css-1y5zoos" href="/about">About</a><a class="css-1y5zoos" href="/blog">Blog</a></nav></div><style data-emotion-css="af3ja4">.css-af3ja4{opacity:0.65;position:relative;border-radius:5px;width:40px;height:25px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-transition:opacity 0.3s ease;transition:opacity 0.3s ease;border:none;outline:none;background:none;cursor:pointer;padding:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;}.css-af3ja4:hover,.css-af3ja4:focus{opacity:1;}</style><button type="button" aria-label="Activate Dark Mode" title="Activate Dark Mode" class="css-af3ja4"><style data-emotion-css="iiu7h7">.css-iiu7h7{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent,transparent);-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);-webkit-transition:all 0.45s ease;transition:all 0.45s ease;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon,#2d3748);}.css-iiu7h7:before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;-webkit-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0);opacity:1;-webkit-transition:-webkit-transform 0.45s ease;-webkit-transition:transform 0.45s ease;transition:transform 0.45s ease;}.css-iiu7h7:after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0 0 -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon,#2d3748),0 23px 0 var(--theme-ui-colors-toggleIcon,#2d3748),23px 0 0 var(--theme-ui-colors-toggleIcon,#2d3748),-23px 0 0 var(--theme-ui-colors-toggleIcon,#2d3748),15px 15px 0 var(--theme-ui-colors-toggleIcon,#2d3748),-15px 15px 0 var(--theme-ui-colors-toggleIcon,#2d3748),15px -15px 0 var(--theme-ui-colors-toggleIcon,#2d3748),-15px -15px 0 var(--theme-ui-colors-toggleIcon,#2d3748);-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);-webkit-transition:all 0.35s ease;transition:all 0.35s ease;}</style><div class="css-iiu7h7"></div></button></div></header><style data-emotion-css="1tgehn6">.css-1tgehn6 [data-name='live-editor']{font-size:1rem;}.css-1tgehn6 [data-name='live-editor'] textarea,.css-1tgehn6 [data-name='live-editor'] pre{padding:1rem !important;}.css-1tgehn6 [data-name='live-preview']{padding:calc(0.5rem + 10px) !important;background-color:#bfd2e7;}.css-1tgehn6 .prism-code{font-size:1rem;padding:2rem 1rem 1rem 1rem;webkit-overflow-scrolling:touch;background-color:var(--theme-ui-colors-transparent,transparent);min-width:100%;margin-bottom:0;margin-top:0;overflow:auto;}@media screen and (min-width:640px){.css-1tgehn6 .prism-code{font-size:1rem;}}@media screen and (min-width:768px){.css-1tgehn6 .prism-code{font-size:1.1rem;}}.css-1tgehn6 .prism-code[data-linenumber="false"] .token-line{padding-left:1rem;}.css-1tgehn6 .gatsby-highlight[data-language=''] .prism-code,.css-1tgehn6 .gatsby-highlight[data-language='noLineNumbers'] .prism-code{padding-top:1rem;}.css-1tgehn6 .token{display:inline-block;}.css-1tgehn6 p > code,.css-1tgehn6 li > code{background-color:var(--theme-ui-colors-gray-2,#edf2f7);color:var(--theme-ui-colors-gray-8,#2d3748);padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-radius:2px;}.css-1tgehn6 .gatsby-highlight{font-size:1rem;position:relative;webkit-overflow-scrolling:touch;background-color:rgb(1,22,39);border-radius:2px;margin-left:0;margin-right:0;}@media screen and (min-width:640px){.css-1tgehn6 .gatsby-highlight{font-size:1rem;margin-left:0;margin-right:0;}}@media screen and (min-width:768px){.css-1tgehn6 .gatsby-highlight{font-size:1.1rem;margin-left:0;margin-right:0;}}@media screen and (min-width:1024px){.css-1tgehn6 .gatsby-highlight{margin-left:-1rem;margin-right:-1rem;}}.css-1tgehn6 .gatsby-highlight .token-line{margin-left:-1rem;margin-right:-1rem;min-width:100%;}.css-1tgehn6 .gatsby-highlight pre code{float:left;min-width:100%;}.css-1tgehn6 .gatsby-highlight pre[class*="language-"]:before{background-color:var(--theme-ui-colors-white,#fff);border-radius:0 0 0.25rem 0.25rem;color:var(--theme-ui-colors-black,#000);font-size:12px;-webkit-letter-spacing:0.025rem;-moz-letter-spacing:0.025rem;-ms-letter-spacing:0.025rem;letter-spacing:0.025rem;padding:0.1rem 0.5rem;position:absolute;left:1rem;text-align:right;text-transform:uppercase;top:0;}.css-1tgehn6 .gatsby-highlight pre[class~="language-javascript"]:before,.css-1tgehn6 .gatsby-highlight pre[class~="language-js"]:before{content:"js";background:#f7df1e;color:var(--theme-ui-colors-black,#000);}.css-1tgehn6 .gatsby-highlight pre[class~="language-jsx"]:before{content:"jsx";background:#61dafb;color:var(--theme-ui-colors-black,#000);}.css-1tgehn6 .gatsby-highlight pre[class~="language-ts"]:before{content:"ts";background:#61dafb;color:var(--theme-ui-colors-black,#000);}.css-1tgehn6 .gatsby-highlight pre[class~="language-tsx"]:before{content:"tsx";background:#61dafb;color:var(--theme-ui-colors-black,#000);}.css-1tgehn6 .gatsby-highlight pre[class~="language-html"]:before{content:"html";background:#005a9c;color:var(--theme-ui-colors-white,#fff);}.css-1tgehn6 .gatsby-highlight pre[class~="language-xml"]:before{content:"xml";background:#005a9c;color:var(--theme-ui-colors-white,#fff);}.css-1tgehn6 .gatsby-highlight pre[class~="language-svg"]:before{content:"svg";background:#005a9c;color:var(--theme-ui-colors-white,#fff);}.css-1tgehn6 .gatsby-highlight pre[class~="language-graphql"]:before{content:"GraphQL";background:#E10098;}.css-1tgehn6 .gatsby-highlight pre[class~="language-css"]:before{content:"css";background:#ff9800;color:var(--theme-ui-colors-black,#000);}.css-1tgehn6 .gatsby-highlight pre[class~="language-mdx"]:before{content:"mdx";background:#f9ac00;color:var(--theme-ui-colors-black,#000);}.css-1tgehn6 .gatsby-highlight pre[class~="language-php"]:before{content:"php";background:#777bb3;color:var(--theme-ui-colors-black,#000);}.css-1tgehn6 .gatsby-highlight pre[class~="language-py"]:before,.css-1tgehn6 .gatsby-highlight pre[class~="language-python"]:before{content:"py";background:#306998;color:var(--theme-ui-colors-white,#fff);}.css-1tgehn6 .gatsby-highlight pre[class~="language-text"]:before{content:"text";}.css-1tgehn6 .gatsby-highlight pre[class~='language-shell']:before{content:'shell';}.css-1tgehn6 .gatsby-highlight pre[class~='language-sh']:before{content:'sh';}.css-1tgehn6 .gatsby-highlight pre[class~='language-bash']:before{content:'bash';}.css-1tgehn6 .gatsby-highlight pre[class~='language-yaml']:before{content:'yaml';background:#ffa8df;}.css-1tgehn6 .gatsby-highlight pre[class~='language-yml']:before{content:'yml';background:#ffa8df;}.css-1tgehn6 .gatsby-highlight pre[class~='language-markdown']:before{content:'md';}.css-1tgehn6 .gatsby-highlight pre[class~='language-json']:before,.css-1tgehn6 .gatsby-highlight pre[class~='language-json5']:before{content:'json';background:linen;}.css-1tgehn6 .gatsby-highlight pre[class~='language-diff']:before{content:'diff';background:#e6ffed;}.css-1tgehn6 .gatsby-highlight > code[class*="language-"],.css-1tgehn6 .gatsby-highlight > pre[class=*="language-"]{word-spacing:normal;word-break:normal;overflow-wrap:normal;line-height:1.5;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1tgehn6 .gatsby-highlight pre::-webkit-scrollbar{width:0.5rem;height:0.5rem;}.css-1tgehn6 .gatsby-highlight pre::-webkit-scrollbar-thumb{background-color:var(--theme-ui-colors-primary,#2b6cb0);}.css-1tgehn6 .gatsby-highlight pre::-webkit-scrollbar-track{background:rgb(1,22,39);}.css-1tgehn6 .line-number-style{display:inline-block;width:3em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.3;text-align:center;position:relative;}.css-1tgehn6 .code-title{background-color:#bfd2e7;color:var(--theme-ui-colors-black,#000);font-size:0.75rem;padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;margin-left:0;margin-right:0;}@media screen and (min-width:640px){.css-1tgehn6 .code-title{margin-left:0;margin-right:0;}}@media screen and (min-width:768px){.css-1tgehn6 .code-title{margin-left:0;margin-right:0;}}@media screen and (min-width:1024px){.css-1tgehn6 .code-title{margin-left:-1rem;margin-right:-1rem;}}.css-1tgehn6 [data-name='live-preview'],.css-1tgehn6 [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1rem;}@media screen and (min-width:640px){.css-1tgehn6 [data-name='live-preview'],.css-1tgehn6 [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1rem;}}@media screen and (min-width:768px){.css-1tgehn6 [data-name='live-preview'],.css-1tgehn6 [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1.1rem;}}@media screen and (min-width:1024px){.css-1tgehn6 [data-name='live-preview'],.css-1tgehn6 [data-name='live-editor']{margin-left:-1rem;margin-right:-1rem;}}.css-1tgehn6 .token-line{padding-right:1rem;}.css-1tgehn6 .highlight-line{background-color:rgb(2,55,81);border-left:4px solid rgb(2,155,206);}.css-1tgehn6 .highlight-line .line-number-style{width:calc(3em - 4px);opacity:0.5;left:-2px;}.css-1tgehn6 .react-live-wrapper{position:relative;}.css-1tgehn6 .react-live-wrapper .code-copy-button{right:0;}@media screen and (min-width:640px){.css-1tgehn6 .react-live-wrapper .code-copy-button{right:0;}}@media screen and (min-width:768px){.css-1tgehn6 .react-live-wrapper .code-copy-button{right:0;}}@media screen and (min-width:1024px){.css-1tgehn6 .react-live-wrapper .code-copy-button{right:-1rem;}}</style><style data-emotion-css="l4bzul">.css-l4bzul{box-sizing:border-box;margin:0;min-width:0;}.css-l4bzul [data-name='live-editor']{font-size:1rem;}.css-l4bzul [data-name='live-editor'] textarea,.css-l4bzul [data-name='live-editor'] pre{padding:1rem !important;}.css-l4bzul [data-name='live-preview']{padding:calc(0.5rem + 10px) !important;background-color:#bfd2e7;}.css-l4bzul .prism-code{font-size:1rem;padding:2rem 1rem 1rem 1rem;webkit-overflow-scrolling:touch;background-color:var(--theme-ui-colors-transparent,transparent);min-width:100%;margin-bottom:0;margin-top:0;overflow:auto;}@media screen and (min-width:640px){.css-l4bzul .prism-code{font-size:1rem;}}@media screen and (min-width:768px){.css-l4bzul .prism-code{font-size:1.1rem;}}.css-l4bzul .prism-code[data-linenumber="false"] .token-line{padding-left:1rem;}.css-l4bzul .gatsby-highlight[data-language=''] .prism-code,.css-l4bzul .gatsby-highlight[data-language='noLineNumbers'] .prism-code{padding-top:1rem;}.css-l4bzul .token{display:inline-block;}.css-l4bzul p > code,.css-l4bzul li > code{background-color:var(--theme-ui-colors-gray-2,#edf2f7);color:var(--theme-ui-colors-gray-8,#2d3748);padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-radius:2px;}.css-l4bzul .gatsby-highlight{font-size:1rem;position:relative;webkit-overflow-scrolling:touch;background-color:rgb(1,22,39);border-radius:2px;margin-left:0;margin-right:0;}@media screen and (min-width:640px){.css-l4bzul .gatsby-highlight{font-size:1rem;margin-left:0;margin-right:0;}}@media screen and (min-width:768px){.css-l4bzul .gatsby-highlight{font-size:1.1rem;margin-left:0;margin-right:0;}}@media screen and (min-width:1024px){.css-l4bzul .gatsby-highlight{margin-left:-1rem;margin-right:-1rem;}}.css-l4bzul .gatsby-highlight .token-line{margin-left:-1rem;margin-right:-1rem;min-width:100%;}.css-l4bzul .gatsby-highlight pre code{float:left;min-width:100%;}.css-l4bzul .gatsby-highlight pre[class*="language-"]:before{background-color:var(--theme-ui-colors-white,#fff);border-radius:0 0 0.25rem 0.25rem;color:var(--theme-ui-colors-black,#000);font-size:12px;-webkit-letter-spacing:0.025rem;-moz-letter-spacing:0.025rem;-ms-letter-spacing:0.025rem;letter-spacing:0.025rem;padding:0.1rem 0.5rem;position:absolute;left:1rem;text-align:right;text-transform:uppercase;top:0;}.css-l4bzul .gatsby-highlight pre[class~="language-javascript"]:before,.css-l4bzul .gatsby-highlight pre[class~="language-js"]:before{content:"js";background:#f7df1e;color:var(--theme-ui-colors-black,#000);}.css-l4bzul .gatsby-highlight pre[class~="language-jsx"]:before{content:"jsx";background:#61dafb;color:var(--theme-ui-colors-black,#000);}.css-l4bzul .gatsby-highlight pre[class~="language-ts"]:before{content:"ts";background:#61dafb;color:var(--theme-ui-colors-black,#000);}.css-l4bzul .gatsby-highlight pre[class~="language-tsx"]:before{content:"tsx";background:#61dafb;color:var(--theme-ui-colors-black,#000);}.css-l4bzul .gatsby-highlight pre[class~="language-html"]:before{content:"html";background:#005a9c;color:var(--theme-ui-colors-white,#fff);}.css-l4bzul .gatsby-highlight pre[class~="language-xml"]:before{content:"xml";background:#005a9c;color:var(--theme-ui-colors-white,#fff);}.css-l4bzul .gatsby-highlight pre[class~="language-svg"]:before{content:"svg";background:#005a9c;color:var(--theme-ui-colors-white,#fff);}.css-l4bzul .gatsby-highlight pre[class~="language-graphql"]:before{content:"GraphQL";background:#E10098;}.css-l4bzul .gatsby-highlight pre[class~="language-css"]:before{content:"css";background:#ff9800;color:var(--theme-ui-colors-black,#000);}.css-l4bzul .gatsby-highlight pre[class~="language-mdx"]:before{content:"mdx";background:#f9ac00;color:var(--theme-ui-colors-black,#000);}.css-l4bzul .gatsby-highlight pre[class~="language-php"]:before{content:"php";background:#777bb3;color:var(--theme-ui-colors-black,#000);}.css-l4bzul .gatsby-highlight pre[class~="language-py"]:before,.css-l4bzul .gatsby-highlight pre[class~="language-python"]:before{content:"py";background:#306998;color:var(--theme-ui-colors-white,#fff);}.css-l4bzul .gatsby-highlight pre[class~="language-text"]:before{content:"text";}.css-l4bzul .gatsby-highlight pre[class~='language-shell']:before{content:'shell';}.css-l4bzul .gatsby-highlight pre[class~='language-sh']:before{content:'sh';}.css-l4bzul .gatsby-highlight pre[class~='language-bash']:before{content:'bash';}.css-l4bzul .gatsby-highlight pre[class~='language-yaml']:before{content:'yaml';background:#ffa8df;}.css-l4bzul .gatsby-highlight pre[class~='language-yml']:before{content:'yml';background:#ffa8df;}.css-l4bzul .gatsby-highlight pre[class~='language-markdown']:before{content:'md';}.css-l4bzul .gatsby-highlight pre[class~='language-json']:before,.css-l4bzul .gatsby-highlight pre[class~='language-json5']:before{content:'json';background:linen;}.css-l4bzul .gatsby-highlight pre[class~='language-diff']:before{content:'diff';background:#e6ffed;}.css-l4bzul .gatsby-highlight > code[class*="language-"],.css-l4bzul .gatsby-highlight > pre[class=*="language-"]{word-spacing:normal;word-break:normal;overflow-wrap:normal;line-height:1.5;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-l4bzul .gatsby-highlight pre::-webkit-scrollbar{width:0.5rem;height:0.5rem;}.css-l4bzul .gatsby-highlight pre::-webkit-scrollbar-thumb{background-color:var(--theme-ui-colors-primary,#2b6cb0);}.css-l4bzul .gatsby-highlight pre::-webkit-scrollbar-track{background:rgb(1,22,39);}.css-l4bzul .line-number-style{display:inline-block;width:3em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.3;text-align:center;position:relative;}.css-l4bzul .code-title{background-color:#bfd2e7;color:var(--theme-ui-colors-black,#000);font-size:0.75rem;padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;margin-left:0;margin-right:0;}@media screen and (min-width:640px){.css-l4bzul .code-title{margin-left:0;margin-right:0;}}@media screen and (min-width:768px){.css-l4bzul .code-title{margin-left:0;margin-right:0;}}@media screen and (min-width:1024px){.css-l4bzul .code-title{margin-left:-1rem;margin-right:-1rem;}}.css-l4bzul [data-name='live-preview'],.css-l4bzul [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1rem;}@media screen and (min-width:640px){.css-l4bzul [data-name='live-preview'],.css-l4bzul [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1rem;}}@media screen and (min-width:768px){.css-l4bzul [data-name='live-preview'],.css-l4bzul [data-name='live-editor']{margin-left:0;margin-right:0;font-size:1.1rem;}}@media screen and (min-width:1024px){.css-l4bzul [data-name='live-preview'],.css-l4bzul [data-name='live-editor']{margin-left:-1rem;margin-right:-1rem;}}.css-l4bzul .token-line{padding-right:1rem;}.css-l4bzul .highlight-line{background-color:rgb(2,55,81);border-left:4px solid rgb(2,155,206);}.css-l4bzul .highlight-line .line-number-style{width:calc(3em - 4px);opacity:0.5;left:-2px;}.css-l4bzul .react-live-wrapper{position:relative;}.css-l4bzul .react-live-wrapper .code-copy-button{right:0;}@media screen and (min-width:640px){.css-l4bzul .react-live-wrapper .code-copy-button{right:0;}}@media screen and (min-width:768px){.css-l4bzul .react-live-wrapper .code-copy-button{right:0;}}@media screen and (min-width:1024px){.css-l4bzul .react-live-wrapper .code-copy-button{right:-1rem;}}</style><div id="skip-nav" class=" css-l4bzul"><style data-emotion-css="7c8i03">.css-7c8i03{box-sizing:border-box;margin:0;min-width:0;font-family:inherit;font-weight:500;line-height:1.25;font-family:inherit;font-weight:500;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.8rem;margin-top:2rem;color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-7c8i03{font-size:2rem;}}@media screen and (min-width:768px){.css-7c8i03{font-size:2rem;}}@media screen and (min-width:1024px){.css-7c8i03{font-size:2.6rem;}}</style><h1 class="css-7c8i03">Building a battery-powered wireless sensor using Bluetooth Low-Energy (BLE) and Apple HomeKit (Part 3)</h1><style data-emotion-css="12mg7v7">.css-12mg7v7{color:var(--theme-ui-colors-secondary,#718096);margin-top:1rem;font-size:1rem;}.css-12mg7v7 a{color:var(--theme-ui-colors-secondary,#718096);}@media screen and (min-width:640px){.css-12mg7v7{font-size:1rem;}}@media screen and (min-width:768px){.css-12mg7v7{font-size:1.1rem;}}</style><p class="css-12mg7v7"><time>2017-12-05</time> — <a class="css-1y5zoos" href="/tags/hardware">hardware</a>, <a class="css-1y5zoos" href="/tags/software">software</a>, <a class="css-1y5zoos" href="/tags/internet-of-things">internet-of-things</a>, <a class="css-1y5zoos" href="/tags/bluetooth-low-energy">bluetooth-low-energy</a>, <a class="css-1y5zoos" href="/tags/arduino">arduino</a>, <a class="css-1y5zoos" href="/tags/c">c</a>, <a class="css-1y5zoos" href="/tags/homekit">homekit</a>, <a class="css-1y5zoos" href="/tags/nrf-52832">nrf52832</a> — <span>5<!-- --> min read</span></p><style data-emotion-css="f0b8g7">.css-f0b8g7{margin-top:4rem;margin-bottom:4rem;}.css-f0b8g7 .gatsby-resp-image-wrapper{margin-top:2rem;margin-bottom:2rem;box-shadow:rgba(0,0,0,0.15) 0px 32px 32px 0px,rgba(0,0,0,0.15) 0px 16px 16px 0px,rgba(0,0,0,0.15) 0px 8px 8px 0px,rgba(0,0,0,0.15) 0px 4px 4px 0px;}@media screen and (min-width:640px){.css-f0b8g7 .gatsby-resp-image-wrapper{margin-top:2rem;margin-bottom:2rem;}}@media screen and (min-width:768px){.css-f0b8g7 .gatsby-resp-image-wrapper{margin-top:4rem;margin-bottom:4rem;}}</style><section class="css-f0b8g7"><style data-emotion-css="ocxwk4">.css-ocxwk4{font-size:1rem;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;word-break:break-word;}@media screen and (min-width:640px){.css-ocxwk4{font-size:1rem;}}@media screen and (min-width:768px){.css-ocxwk4{font-size:1.1rem;}}</style><p class="css-ocxwk4"><em class="css-0">This is the third post in a series about building a simple wireless temperature and humidity sensor using inexpensive components, Bluetooth Low Energy (BLE) for communication, and Apple HomeKit to read sensor values. For the previous post, see <style data-emotion-css="1i9b1eb">.css-1i9b1eb{color:var(--theme-ui-colors-primary,#2b6cb0);-webkit-text-decoration:none;text-decoration:none;}.css-1i9b1eb:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a href="/blog/ble-homekit-sensor-pt2" class="css-1i9b1eb">Part 2</a></em>.</p><p class="css-ocxwk4">In the previous post, we covered the <strong class="css-0">hardware selection</strong>, <strong class="css-0">hardware assembly</strong>, and <strong class="css-0">software architecture</strong>. In this post, we&#x27;ll cover the last, crucial piece needed to make everything work: the software implementation.</p><p class="css-ocxwk4">This post includes the source code and all the information you need in order to get your own sensor and bridge hardware running.</p><style data-emotion-css="992wu8">.css-992wu8{font-family:inherit;font-weight:500;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.6rem;margin-top:2rem;color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-992wu8{font-size:1.8rem;}}@media screen and (min-width:768px){.css-992wu8{font-size:1.8rem;}}@media screen and (min-width:1024px){.css-992wu8{font-size:2rem;}}</style><h2 class="css-992wu8">Source code repository</h2><p class="css-ocxwk4">The source code for this project can be found on GitHub at <a href="https://github.com/danielpgross/homekit-ble-temp-humid-sensor" class="css-1i9b1eb">danielpgross/homekit-ble-temp-humid-sensor</a>.</p><p class="css-ocxwk4">If you&#x27;d like to follow along with the instructions using your own bridge and sensor hardware, you&#x27;ll want to start by cloning that repository to a local place.</p><h2 class="css-992wu8">Sensor module</h2><p class="css-ocxwk4">The sensor module runs on the WRL-13990 Bluetooth module, which is built around the nRF52832. Its purpose is to take readings from the temperature/humidity sensor and relay those readings back to the HomeKit bridge (see the bridge module below).</p><style data-emotion-css="3omw84">.css-3omw84{font-family:inherit;font-weight:500;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.3rem;margin-top:2rem;color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-3omw84{font-size:1.6rem;}}@media screen and (min-width:768px){.css-3omw84{font-size:1.6rem;}}@media screen and (min-width:1024px){.css-3omw84{font-size:1.8rem;}}</style><h3 class="css-3omw84">Implementation discussion</h3><p class="css-ocxwk4">The nRF52832 is a system-on-a-chip (SoC) built around the ARM Cortex M4 processor. Nordic provides a software development kit (SDK) that allows developers to write C code to program the device. Additionally, the chip is programmed by default with a &quot;softdevice&quot; that manages the fine details of BLE communication, allowing the developer to focus on the business logic of the application at hand.</p><p class="css-ocxwk4">This diagram from the <a href="http://infocenter.nordicsemi.com/pdf/S132_SDS_v5.0.pdf" class="css-1i9b1eb">S132 SoftDevice specification</a> illustrates the general architecture of software implementations on the nRF52832:
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:462px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:102.91666666666669%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAADzklEQVQ4y5WUyW/bVhDG9fcWaM9FL0Xc9tZLUMRFsxSNgyKJ7dqWZC2UTNqkxFUbSUkktXDRRi12DDt2cv06fLKV2j3l8MM38zhvMPNmwJTnmbAtBW1bI9QN3Y4B16nB6Rpk6xubQXaHzv4bz2hrSFmWTE6FklY22mnLkMRjFPK7EPg0qpU8Crn3zD4pH4Lj9qEqHIu7v3d/N8WqsyTm2KRmS2Qfa8YJFLkAQy+jURcoQRG6VmJoKsfOkjuWKcI2JXbXIk35vkdOUn6N2mohCnvokiZ4nk1YjMGgw9R1LXaeqOOY7MxxTbLX8amk77ZdpaRV9i7nqwWctoFWvYp40sfl+QgdS0OjRjEtDcs4wPXlDOGww2IahoTzRYgPqxHOlxG9oXn/hhKcjopoOsexMcSxPkCONGcMkCX7QGpj/7SFA9FCWu4iq/aQ1frIkK7jhijWh+uEyVuY1H/PUaE5Y/yYDrGVHuLJ0RBb2Qg/H0f4/k0N322f4JuneXy7XcYPb006D/FTxscW8STt4xfyU8m4nW6yJgqGPQNKJ8Su1IdoBhCaAf7gPBwaUxStJQrWao25RL612JBrzcFZC7zgfaR0TYB4lmUr0TR46E6EvZMGRM2EIDfxsmBBdC+h+x+hDK+hPuAjQxlcox7dYkekChW5jFcvn+L3Z79CqdKauCPs8y1UjTbOVJMlFLofoEefoQWfoAa3DC38Yiv+Leqjz/jrLGm5rbK9ksTcXcsR3vAOSrqHnOLieamHkhkjI/dwVPVoIDQE3Uea7Kw6YBySzdVDvE4qTIaSbHyyOj1HYwn/FrrgDRec6uJFycWJvaAJRjTJkHQErjFG3giYJn6+FkGwZncJLflu4yWWUOtShTkF7w5yOMqf4lVx3TJrkVpLUPybu1Zv1v7wBjV6kk2F9wn7SYXtAAdnFop8Bdypih1q/8y5gBHeQKPBJOiPSAbTHH1aD6XT1tnaWJS072qoeRP8yfdosX0cKQP8VvDwVpngHyPGnj7DPpHorjrZ8J7Y06bYLtPaBEEftl1HEAwxnkywvLiipFNqfUQrNEazH6PSor1seEylZo+pTt8N5wuJbw5m9LexG5CkMvoDH+P4A8LJErP5+QN0owlZNWDUW1D1OhpNG5N4iXhxsY5ZJFxgOl8hFcchrq5izOch4jjCnIgfsVpNidlGl8vp/2LuScXzKbUaYjobYUI6HgdE+IDRKCD8OyVYzOO4gOVJFQUZz3f28PpdBrsZHpmyjDRXRbr0ldCdLN1NiUqNEpVwkOPpoIKCoCIvKF8Pr6BIa/Yv7zeVbIV2hyQAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="nrf5 ble arch" title="nrf5 ble arch" src="/static/1cdb0859240c6f025bfa4d9adfda7599/36de5/nrf5-ble-arch.png" srcSet="/static/1cdb0859240c6f025bfa4d9adfda7599/5243c/nrf5-ble-arch.png 240w,/static/1cdb0859240c6f025bfa4d9adfda7599/36de5/nrf5-ble-arch.png 462w" sizes="(max-width: 462px) 100vw, 462px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-ocxwk4">For more information on the nRF52832&#x27;s software, check out the following resources:</p><style data-emotion-css="aq9zkf">.css-aq9zkf li{font-size:1rem;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width:640px){.css-aq9zkf li{font-size:1rem;}}@media screen and (min-width:768px){.css-aq9zkf li{font-size:1.1rem;}}</style><ul class="css-aq9zkf"><li class="css-0"><a href="http://infocenter.nordicsemi.com/index.jsp?topic=%2Fcom.nordic.infocenter.sdk%2Fdita%2Fsdk%2Fnrf5_sdk.html" class="css-1i9b1eb">nRF5 SDK Documentation</a></li><li class="css-0"><a href="http://infocenter.nordicsemi.com/index.jsp?topic=%2Fcom.nordic.infocenter.softdevices52%2Fdita%2Fnrf52%2Fsoftdevices.html&amp;cp=2_3" class="css-1i9b1eb">nRF5 SoftDevice Documentation</a></li></ul><p class="css-ocxwk4">The nRF52832 can be very tricky to program because there&#x27;s very little transparency into what&#x27;s going on inside the device. Although it&#x27;s possible to set up a line-by-line debugger, this requires extra hardware, as far as I was able to find. Therefore, programming the devices requires lots of patience :-)...</p><style data-emotion-css="1pmnorg">.css-1pmnorg{font-family:inherit;font-weight:500;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.1rem;color:var(--theme-ui-colors-heading,#000);margin-top:1rem;}@media screen and (min-width:640px){.css-1pmnorg{font-size:1.3rem;}}@media screen and (min-width:768px){.css-1pmnorg{font-size:1.3rem;}}@media screen and (min-width:1024px){.css-1pmnorg{font-size:1.6rem;}}</style><h4 class="css-1pmnorg">Making the SDK code build and run on the WRL-13990</h4><p class="css-ocxwk4">Nordic&#x27;s SDK code is written to support different boards built on the nRF52832, but not including the WRL-13990. This meant that some wrangling was necessary to get the code to build and run properly on the WRL-13990. Luckily, I was able to get this working by cobbling together other pieces of code that I knew worked on the WRL-13990, including <a href="https://github.com/sandeepmistry/arduino-nRF5" class="css-1i9b1eb">the nRF5 Arduino core code</a>.</p><h4 class="css-1pmnorg">Temperature readings</h4><p class="css-ocxwk4">The nRF5 SDK does not natively support reading data from the DHT-22 sensor. This turned out to be more complicated than I thought, but I fortunately stumbled across Gabor Paller&#x27;s <a href="http://mylifewithandroid.blogspot.ca/2016/02/thermometer-application-with-nrf51822.html" class="css-1i9b1eb">blog post on using the DHT-22 with an nRF51822</a>. He wrote a complete implementation for reading DHT-22 sensor values and I was able to use this directly in my own implementation. </p><h4 class="css-1pmnorg">BLE broadcast format</h4><p class="css-ocxwk4">The sensor module broadcasts readings with the BLE service ID <code class="css-0">7B18</code> and with the actual temperature and humidity readings in the BLE GAP service data. Using this approach, a listening device <em class="css-0">does not need to pair with the sensor</em>, it just needs to look for the appropriate service ID and then read the value of the service data. To see exactly how the temperature and humidity are encoded, see the <a href="https://github.com/danielpgross/homekit-ble-temp-humid-sensor/blob/d9d85c7afd3e7e6ddb8a10b890ce69e1c8a00d7c/bridge/TempHumidSensor_accessory.js#L42-L43" class="css-1i9b1eb">decoding implementation</a>.</p><h3 class="css-3omw84">Using it yourself</h3><p class="css-ocxwk4"><em class="css-0">The following is copied from the <a href="https://github.com/danielpgross/homekit-ble-temp-humid-sensor/blob/master/sensor/README.md" class="css-1i9b1eb">README file in the source code repository</a>. Please see that file to keep up to date with any changes.</em></p><p class="css-ocxwk4">This is firmware code for the nRF52832. To use it, you need to compile it to binary code and then flash it to your device.</p><h4 class="css-1pmnorg">Requirements</h4><ul class="css-aq9zkf"><li class="css-0">The nRF5 SDK, which provides the necessary compilation resources and tools. Instructions to download it are in step 1 below.</li><li class="css-0">Installation of <strong class="css-0">version 0.5.2</strong> of <a href="https://github.com/NordicSemiconductor/pc-nrfutil" class="css-1i9b1eb">Nordic&#x27;s nrfutil program</a>. Installation instructions are provided at the source.</li></ul><h4 class="css-1pmnorg">Compilation &amp; flashing</h4><ol class="css-aq9zkf"><li class="css-0"><p class="css-ocxwk4">Download the <a href="https://developer.nordicsemi.com/nRF5_SDK/nRF5_SDK_v11.x.x/nRF5_SDK_11.0.0_89a8197.zip" class="css-1i9b1eb">nRF5 SDK version 11.0.0</a>.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><style data-emotion-css="1heep1n">.css-1heep1n{background-color:rgba(43,108,176,0.2);border:none;color:var(--theme-ui-colors-gray-2,#edf2f7);cursor:pointer;font-size:14px;font-family:"IBM Plex Sans",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";-webkit-letter-spacing:0.025rem;-moz-letter-spacing:0.025rem;-ms-letter-spacing:0.025rem;letter-spacing:0.025rem;-webkit-transition:default;transition:default;position:absolute;top:0;right:0;z-index:1;border-radius:0 0 0 0.25rem;padding:0.25rem 0.6rem;}@media screen and (min-width:640px){.css-1heep1n{font-size:14px;}}@media screen and (min-width:768px){.css-1heep1n{font-size:16px;}}.css-1heep1n[disabled]{cursor:not-allowed;}.css-1heep1n:not([disabled]):hover{background-color:var(--theme-ui-colors-primary,#2b6cb0);color:var(--theme-ui-colors-white,#fff);}</style><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<style data-emotion-css="1gy8470">.css-1gy8470{border:0;-webkit-clip:rect(0,0,0,0);clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px;}</style><span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">wget https://developer.nordicsemi.com/nRF5_SDK/nRF5_SDK_v11.x.x/nRF5_SDK_11.0.0_89a8197.zip</span></div></code></pre></div></li><li class="css-0"><p class="css-ocxwk4">Unzip the SDK.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">unzip nRF5_SDK_11.0.0_89a8197.zip</span></div></code></pre></div></li><li class="css-0"><p class="css-ocxwk4">Navigate to this path within the unzipped SDK folder: <code class="css-0">examples/ble_peripheral/</code>.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">cd nRF5_SDK_11.0.0_89a8197/examples/ble_peripheral/</span></div></code></pre></div></li><li class="css-0"><p class="css-ocxwk4">There, copy the entire folder containing this file, with the directory name <code class="css-0">ble_app_temp_humid</code>.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">cp -R /path/to/repo/sensor ./ble_app_temp_humid</span></div></code></pre></div></li><li class="css-0"><p class="css-ocxwk4">Build the code.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">cd ble_app_temp_humid/wrl13990/s132/armgcc</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">make</span></div></code></pre></div><p class="css-ocxwk4">You should see build output as follows:</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">rm -rf _build</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">echo  Makefile</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">Makefile</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">mkdir _build</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">Compiling file: app_button.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">Compiling file: app_error.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">Compiling file: app_error_weak.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">Compiling file: app_fifo.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">Compiling file: app_timer.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">Compiling file: app_trace.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">Compiling file: app_util_platform.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">Compiling file: fstorage.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">13</span><span class="token plain">Compiling file: nrf_assert.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">14</span><span class="token plain">Compiling file: nrf_log.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">15</span><span class="token plain">Compiling file: retarget.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">16</span><span class="token plain">Compiling file: nrf_delay.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">17</span><span class="token plain">Compiling file: nrf_drv_common.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">18</span><span class="token plain">Compiling file: nrf_drv_gpiote.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">19</span><span class="token plain">Compiling file: pstorage.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">20</span><span class="token plain">Compiling file: bsp.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">21</span><span class="token plain">Compiling file: bsp_btn_ble.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">22</span><span class="token plain">Compiling file: main.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">23</span><span class="token plain">Compiling file: dht22.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">24</span><span class="token plain">Compiling file: RTT_Syscalls_GCC.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">25</span><span class="token plain">Compiling file: SEGGER_RTT.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">26</span><span class="token plain">Compiling file: SEGGER_RTT_printf.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">27</span><span class="token plain">Compiling file: ble_advdata.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">28</span><span class="token plain">Compiling file: ble_advertising.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">29</span><span class="token plain">Compiling file: ble_bas.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">30</span><span class="token plain">Compiling file: ble_bps.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">31</span><span class="token plain">Compiling file: ble_conn_params.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">32</span><span class="token plain">Compiling file: ble_dis.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">33</span><span class="token plain">Compiling file: ble_srv_common.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">34</span><span class="token plain">Compiling file: device_manager_peripheral.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">35</span><span class="token plain">Compiling file: system_nrf52.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">36</span><span class="token plain">Compiling file: softdevice_handler.c</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">37</span><span class="token plain">Assembly file: gcc_startup_nrf52.s</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">38</span><span class="token plain">Linking target: nrf52832_xxaa_s132.out</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">39</span><span class="token plain">Preparing: nrf52832_xxaa_s132.bin</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">40</span><span class="token plain">Preparing: nrf52832_xxaa_s132.hex</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">41</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">42</span><span class="token plain"> text      data     bss     dec     hex filename</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">43</span><span class="token plain">  9332      124     768   10224    27f0 _build/nrf52832_xxaa_s132.out</span></div></code></pre></div></li><li class="css-0"><p class="css-ocxwk4">Connect the WRL13990 to your computer and begin flashing the compiled firmware. I used the following command to accomplish that using a FT232RL-based USB-to-serial board.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">nrfutil dfu genpkg --application _build/*.hex pkg.zip &amp;&amp; nrfutil dfu serial --package=pkg.zip --port=/dev/cu.usbserial-00000000 --baudrate=38400</span></div></code></pre></div><p class="css-ocxwk4">With the following output.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">Zip created at pkg.zip</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">Upgrading target on /dev/cu.usbserial-00000000 with DFU package /Users/danielgross/Desktop/ard-temp-sensor/nrf52/nRF5_SDK_11.0.0_89a8197/examples/ble_peripheral/ble_app_temp_humid/wrl13990/s132/armgcc/pkg.zip. Flow control is disabled.</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">  [####################################]  100%          </span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">Device programmed.</span></div></code></pre></div></li></ol><h2 class="css-992wu8">Bridge module</h2><p class="css-ocxwk4">The bridge module can run on any device capable of Bluetooth and wifi communication, as well as running node.js. The bridge&#x27;s purpose is to receive the temperature readings broadcast by the sensor module and retransmit those over the HomeKit protocol.</p><h3 class="css-3omw84">Implementation discussion</h3><h4 class="css-1pmnorg">HomeKit specification</h4><p class="css-ocxwk4">Until earlier this year, the details of the HomeKit specification have been kept private by Apple and only made available to members of the MFi program. Since the MFi program requires submitting an application and paying a membership fee, this information was not available to hobbyists looking to play with HomeKit devices. Fortunately, however, earlier this year Apple made the HomeKit specification available for personal, non-commercial use. The <a href="https://developer.apple.com/homekit/specification/" class="css-1i9b1eb">HomeKit specification</a> can now be accessed for free after creating an Apple Developer account and agreeing to use the documentation only for non-commercial purposes.</p><h4 class="css-1pmnorg">HomeKit framework</h4><p class="css-ocxwk4">As discussed in the first post of this series, I decided to use HAP-NodeJS, a node.js-based implementation of the HomeKit protocol. Since it already implements the details of the HomeKit protocol, implementing our sensor bridge becomes as simple as listening for the BLE broadcasts from the sensor and then calling the appropriate HAP-NodeJS APIs.</p><p class="css-ocxwk4">HAP-NodeJS is meant to run as a single server instance as opposed to a separate instance for each accessory. Therefore, the accessory code for this module is written to be integrated into a HAP-NodeJS instance as opposed to standing on its own.</p><h4 class="css-1pmnorg">BLE framework</h4><p class="css-ocxwk4">To listen for BLE broadcasts, I used the <a href="https://github.com/sandeepmistry/noble" class="css-1i9b1eb"><code class="css-0">noble</code> module</a>, which was the only complete node.js BLE implementation I could find. <code class="css-0">noble</code> is well designed and generally easy to work with, although as of this writing it does not yet support the latest version of macOS.</p><h3 class="css-3omw84">Using it yourself</h3><p class="css-ocxwk4"><em class="css-0">The following is copied from the <a href="https://github.com/danielpgross/homekit-ble-temp-humid-sensor/blob/master/bridge/README.md" class="css-1i9b1eb">README file in the source code repository</a>. Please see that file to keep up to date with any changes.</em></p><p class="css-ocxwk4">The code is a node.js module that is written to be integrated into an instance of <a href="https://github.com/KhaosT/HAP-NodeJS" class="css-1i9b1eb">HAP-NodeJS</a>.</p><h4 class="css-1pmnorg">Requirements</h4><p class="css-ocxwk4">The following applications and libraries need to be present in order for this module to work:</p><ul class="css-aq9zkf"><li class="css-0"><p class="css-ocxwk4">node.js and npm</p></li><li class="css-0"><p class="css-ocxwk4">Libraries for building HomeKit and Bluetooth components. These can be installed on Ubuntu/Debian using: </p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">apt-get install build-essential python libavahi-compat-libdnssd-dev</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">npm install -g node-gyp</span></div></code></pre></div></li></ul><h4 class="css-1pmnorg">Installation</h4><p class="css-ocxwk4">If you have an instance of HAP-NodeJS, you can skip to step 3.</p><ol class="css-aq9zkf"><li class="css-0"><p class="css-ocxwk4">Install HAP-NodeJS.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">git clone https://github.com/KhaosT/HAP-NodeJS.git</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">cd HAP-NodeJS</span></div></code></pre></div></li><li class="css-0"><p class="css-ocxwk4">(recommended) Remove sample accessories from HAP-NodeJS instance.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">rm accessories/*_accessory.js</span></div></code></pre></div></li><li class="css-0"><p class="css-ocxwk4">Copy TempHumidSensor_accessory.js into accessories folder.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">cp /path/to/repo/bridge/TempHumidSensor_accessory.js accessories/</span></div></code></pre></div></li><li class="css-0"><p class="css-ocxwk4">Install node modules.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">npm install</span></div></code></pre></div></li><li class="css-0"><p class="css-ocxwk4">Manually install the <code class="css-0">noble</code> BLE module in the HAP-NodeJS root. This is required for the temperature/humidity accessory.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">npm install noble</span></div></code></pre></div></li><li class="css-0"><p class="css-ocxwk4">Finally, start HAP-NodeJS.</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-" style="color:#d6deeb;background-color:#011627" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-1heep1n">Copy<span aria-roledescription="status" class="css-1gy8470">copy code to clipboard</span></button><code class="language-"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token plain">node Core.js</span></div></code></pre></div></li></ol><h2 class="css-992wu8">End-to-end demonstration</h2><p class="css-ocxwk4">At last! We&#x27;ve completed building the hardware and software for the project and it&#x27;s time to see the fruits of our efforts. Once you&#x27;ve followed the instructions in the above sections to get the sensor and bridge modules running, the final step is to complete accessory pairing in the Home app on your iOS device.</p><ol class="css-aq9zkf"><li class="css-0">Turn on the sensor by connecting it to power.</li><li class="css-0">Activate the bridge module by starting HAP-NodeJS (see above).</li><li class="css-0">On your iOS device, open the &quot;Home&quot; app and follow along with the steps below:</li></ol><div style="display:flex;flex-wrap:wrap;overflow:auto"><div style="max-width:250px;margin:1em"><img src="/static/hk-pairing-1-9a53716d232f224c023a39bad1f2386d.png" style="max-width:100%" alt="Pairing step 1"/><div><p>Press &quot;Add Accessory&quot;</p></div></div><div style="max-width:250px;margin:1em"><img src="/static/hk-pairing-2-32f0db1778bc7e73b91680c960b9d19d.png" style="max-width:100%" alt="Pairing step 2"/><div><p>Press &quot;Temperature Humidity Sensor&quot;</p></div></div><div style="max-width:250px;margin:1em"><img src="/static/hk-pairing-3-a9e2ba6dd9d819b0ff3af2a9eb5c4331.png" style="max-width:100%" alt="Pairing step 3"/><div><p>When prompted, click &quot;Add Anyway&quot;. Enter the HomeKit Code that&#x27;s hardcoded, the default is 031-45-154.</p></div></div><div style="max-width:250px;margin:1em"><img src="/static/hk-pairing-4-31cd8318a28174199f25a04bb55d6b7c.png" style="max-width:100%" alt="Pairing step 4"/><div><p></p></div></div><div style="max-width:250px;margin:1em"><img src="/static/hk-pairing-5-95393215940ffecfba64c770364e7f83.png" style="max-width:100%" alt="Pairing step 5"/><div><p></p></div></div><div style="max-width:250px;margin:1em"><img src="/static/hk-pairing-6-0552665da7008d8bad3e34a362ab594c.png" style="max-width:100%" alt="Pairing step 6"/><div><p>You should now see 2 new accessories and the humidity and temperature displayed at the top!</p></div></div></div><p class="css-ocxwk4">Thank you for reading this series of posts!</p></section></div><style data-emotion-css="12jsbhh">.css-12jsbhh{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-top:8rem;color:var(--theme-ui-colors-secondary,#718096);-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;border-top-style:solid;border-top-width:1px;border-top-color:var(--theme-ui-colors-divide,#cbd5e0);padding-top:1rem;}.css-12jsbhh a{color:var(--theme-ui-colors-secondary,#718096);-webkit-text-decoration:none;text-decoration:none;}.css-12jsbhh a:hover{color:var(--theme-ui-colors-heading,#000);-webkit-text-decoration:underline;text-decoration:underline;}.css-12jsbhh a:focus{color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-12jsbhh{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}@media screen and (min-width:768px){.css-12jsbhh{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><footer class="css-12jsbhh"><div>© <!-- -->2021<!-- --> by <!-- -->Daniel P. Gross<!-- -->. All rights reserved.</div><div><a aria-label="Link to the theme&#x27;s GitHub repository" href="https://github.com/LekoArts/gatsby-themes/tree/master/themes/gatsby-theme-minimal-blog" class="css-1y5zoos">gatsby-theme-minimal-blog</a> <!-- -->on<!-- --> <a href="https://www.gatsbyjs.com/" class="css-1y5zoos">GatsbyJS</a></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/ble-homekit-sensor-pt3";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-d315eb99cbdcd89ab179.js"],"app":["/app-61629059a767a2c5dd4b.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-ad6431e4664bcf916d19.js"],"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-blog-query-tsx":["/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-blog-query-tsx-f7bd372c9a04a4f2d379.js"],"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-homepage-query-tsx":["/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-homepage-query-tsx-2e76ab67dcd52ecfa1ec.js"],"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-page-query-tsx":["/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-page-query-tsx-6aef444c836abd087a83.js"],"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx":["/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-82ea993409075bcdefe9.js"],"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tag-query-tsx":["/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tag-query-tsx-24e639ccecd169140c07.js"],"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tags-query-tsx":["/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tags-query-tsx-8175ee31937b27f0b9ab.js"]};/*]]>*/</script><script src="/polyfill-d315eb99cbdcd89ab179.js" nomodule=""></script><script src="/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-82ea993409075bcdefe9.js" async=""></script><script src="/aed2e917f30c051bccba91aa15989a75fd0bd633-7af1ba497f02303e5a48.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-61629059a767a2c5dd4b.js" async=""></script><script src="/1bfc9850-ae6f6e854d81acd9ae43.js" async=""></script><script src="/framework-beda7bde9d7dca0755ce.js" async=""></script><script src="/webpack-runtime-0b36765783ddb57012e0.js" async=""></script></body></html>