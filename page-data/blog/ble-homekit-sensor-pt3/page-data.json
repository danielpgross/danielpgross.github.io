{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/blog/ble-homekit-sensor-pt3","result":{"data":{"post":{"__typename":"MdxPost","slug":"/blog/ble-homekit-sensor-pt3","title":"Building a battery-powered wireless sensor using Bluetooth Low-Energy (BLE) and Apple HomeKit (Part 3)","date":"2017-12-05","tags":[{"name":"hardware","slug":"hardware"},{"name":"software","slug":"software"},{"name":"internet-of-things","slug":"internet-of-things"},{"name":"bluetooth-low-energy","slug":"bluetooth-low-energy"},{"name":"arduino","slug":"arduino"},{"name":"c","slug":"c"},{"name":"homekit","slug":"homekit"},{"name":"nrf52832","slug":"nrf-52832"}],"description":null,"canonicalUrl":null,"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Building a battery-powered wireless sensor using Bluetooth Low-Energy (BLE) and Apple HomeKit (Part 3)\",\n  \"date\": \"2017-12-05T00:00:00.000Z\",\n  \"slug\": \"/blog/ble-homekit-sensor-pt3\",\n  \"tags\": [\"hardware\", \"software\", \"internet-of-things\", \"bluetooth-low-energy\", \"arduino\", \"c\", \"homekit\", \"nrf52832\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"This is the third post in a series about building a simple wireless temperature and humidity sensor using inexpensive components, Bluetooth Low Energy (BLE) for communication, and Apple HomeKit to read sensor values. For the previous post, see \", mdx(\"a\", _extends({\n    parentName: \"em\"\n  }, {\n    \"href\": \"/blog/ble-homekit-sensor-pt2\"\n  }), \"Part 2\")), \".\"), mdx(\"p\", null, \"In the previous post, we covered the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"hardware selection\"), \", \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"hardware assembly\"), \", and \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"software architecture\"), \". In this post, we'll cover the last, crucial piece needed to make everything work: the software implementation.\"), mdx(\"p\", null, \"This post includes the source code and all the information you need in order to get your own sensor and bridge hardware running.\"), mdx(\"h2\", null, \"Source code repository\"), mdx(\"p\", null, \"The source code for this project can be found on GitHub at \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/danielpgross/homekit-ble-temp-humid-sensor\"\n  }), \"danielpgross/homekit-ble-temp-humid-sensor\"), \".\"), mdx(\"p\", null, \"If you'd like to follow along with the instructions using your own bridge and sensor hardware, you'll want to start by cloning that repository to a local place.\"), mdx(\"h2\", null, \"Sensor module\"), mdx(\"p\", null, \"The sensor module runs on the WRL-13990 Bluetooth module, which is built around the nRF52832. Its purpose is to take readings from the temperature/humidity sensor and relay those readings back to the HomeKit bridge (see the bridge module below).\"), mdx(\"h3\", null, \"Implementation discussion\"), mdx(\"p\", null, \"The nRF52832 is a system-on-a-chip (SoC) built around the ARM Cortex M4 processor. Nordic provides a software development kit (SDK) that allows developers to write C code to program the device. Additionally, the chip is programmed by default with a \\\"softdevice\\\" that manages the fine details of BLE communication, allowing the developer to focus on the business logic of the application at hand.\"), mdx(\"p\", null, \"This diagram from the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://infocenter.nordicsemi.com/pdf/S132_SDS_v5.0.pdf\"\n  }), \"S132 SoftDevice specification\"), \" illustrates the general architecture of software implementations on the nRF52832:\\n\", mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"462px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"102.91666666666669%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAADzklEQVQ4y5WUyW/bVhDG9fcWaM9FL0Xc9tZLUMRFsxSNgyKJ7dqWZC2UTNqkxFUbSUkktXDRRi12DDt2cv06fLKV2j3l8MM38zhvMPNmwJTnmbAtBW1bI9QN3Y4B16nB6Rpk6xubQXaHzv4bz2hrSFmWTE6FklY22mnLkMRjFPK7EPg0qpU8Crn3zD4pH4Lj9qEqHIu7v3d/N8WqsyTm2KRmS2Qfa8YJFLkAQy+jURcoQRG6VmJoKsfOkjuWKcI2JXbXIk35vkdOUn6N2mohCnvokiZ4nk1YjMGgw9R1LXaeqOOY7MxxTbLX8amk77ZdpaRV9i7nqwWctoFWvYp40sfl+QgdS0OjRjEtDcs4wPXlDOGww2IahoTzRYgPqxHOlxG9oXn/hhKcjopoOsexMcSxPkCONGcMkCX7QGpj/7SFA9FCWu4iq/aQ1frIkK7jhijWh+uEyVuY1H/PUaE5Y/yYDrGVHuLJ0RBb2Qg/H0f4/k0N322f4JuneXy7XcYPb006D/FTxscW8STt4xfyU8m4nW6yJgqGPQNKJ8Su1IdoBhCaAf7gPBwaUxStJQrWao25RL612JBrzcFZC7zgfaR0TYB4lmUr0TR46E6EvZMGRM2EIDfxsmBBdC+h+x+hDK+hPuAjQxlcox7dYkekChW5jFcvn+L3Z79CqdKauCPs8y1UjTbOVJMlFLofoEefoQWfoAa3DC38Yiv+Leqjz/jrLGm5rbK9ksTcXcsR3vAOSrqHnOLieamHkhkjI/dwVPVoIDQE3Uea7Kw6YBySzdVDvE4qTIaSbHyyOj1HYwn/FrrgDRec6uJFycWJvaAJRjTJkHQErjFG3giYJn6+FkGwZncJLflu4yWWUOtShTkF7w5yOMqf4lVx3TJrkVpLUPybu1Zv1v7wBjV6kk2F9wn7SYXtAAdnFop8Bdypih1q/8y5gBHeQKPBJOiPSAbTHH1aD6XT1tnaWJS072qoeRP8yfdosX0cKQP8VvDwVpngHyPGnj7DPpHorjrZ8J7Y06bYLtPaBEEftl1HEAwxnkywvLiipFNqfUQrNEazH6PSor1seEylZo+pTt8N5wuJbw5m9LexG5CkMvoDH+P4A8LJErP5+QN0owlZNWDUW1D1OhpNG5N4iXhxsY5ZJFxgOl8hFcchrq5izOch4jjCnIgfsVpNidlGl8vp/2LuScXzKbUaYjobYUI6HgdE+IDRKCD8OyVYzOO4gOVJFQUZz3f28PpdBrsZHpmyjDRXRbr0ldCdLN1NiUqNEpVwkOPpoIKCoCIvKF8Pr6BIa/Yv7zeVbIV2hyQAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"nrf5 ble arch\",\n    \"title\": \"nrf5 ble arch\",\n    \"src\": \"/static/1cdb0859240c6f025bfa4d9adfda7599/36de5/nrf5-ble-arch.png\",\n    \"srcSet\": [\"/static/1cdb0859240c6f025bfa4d9adfda7599/5243c/nrf5-ble-arch.png 240w\", \"/static/1cdb0859240c6f025bfa4d9adfda7599/36de5/nrf5-ble-arch.png 462w\"],\n    \"sizes\": \"(max-width: 462px) 100vw, 462px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"For more information on the nRF52832's software, check out the following resources:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"http://infocenter.nordicsemi.com/index.jsp?topic=%2Fcom.nordic.infocenter.sdk%2Fdita%2Fsdk%2Fnrf5_sdk.html\"\n  }), \"nRF5 SDK Documentation\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"http://infocenter.nordicsemi.com/index.jsp?topic=%2Fcom.nordic.infocenter.softdevices52%2Fdita%2Fnrf52%2Fsoftdevices.html&cp=2_3\"\n  }), \"nRF5 SoftDevice Documentation\"))), mdx(\"p\", null, \"The nRF52832 can be very tricky to program because there's very little transparency into what's going on inside the device. Although it's possible to set up a line-by-line debugger, this requires extra hardware, as far as I was able to find. Therefore, programming the devices requires lots of patience :-)...\"), mdx(\"h4\", null, \"Making the SDK code build and run on the WRL-13990\"), mdx(\"p\", null, \"Nordic's SDK code is written to support different boards built on the nRF52832, but not including the WRL-13990. This meant that some wrangling was necessary to get the code to build and run properly on the WRL-13990. Luckily, I was able to get this working by cobbling together other pieces of code that I knew worked on the WRL-13990, including \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/sandeepmistry/arduino-nRF5\"\n  }), \"the nRF5 Arduino core code\"), \".\"), mdx(\"h4\", null, \"Temperature readings\"), mdx(\"p\", null, \"The nRF5 SDK does not natively support reading data from the DHT-22 sensor. This turned out to be more complicated than I thought, but I fortunately stumbled across Gabor Paller's \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://mylifewithandroid.blogspot.ca/2016/02/thermometer-application-with-nrf51822.html\"\n  }), \"blog post on using the DHT-22 with an nRF51822\"), \". He wrote a complete implementation for reading DHT-22 sensor values and I was able to use this directly in my own implementation. \"), mdx(\"h4\", null, \"BLE broadcast format\"), mdx(\"p\", null, \"The sensor module broadcasts readings with the BLE service ID \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"7B18\"), \" and with the actual temperature and humidity readings in the BLE GAP service data. Using this approach, a listening device \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"does not need to pair with the sensor\"), \", it just needs to look for the appropriate service ID and then read the value of the service data. To see exactly how the temperature and humidity are encoded, see the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/danielpgross/homekit-ble-temp-humid-sensor/blob/d9d85c7afd3e7e6ddb8a10b890ce69e1c8a00d7c/bridge/TempHumidSensor_accessory.js#L42-L43\"\n  }), \"decoding implementation\"), \".\"), mdx(\"h3\", null, \"Using it yourself\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"The following is copied from the \", mdx(\"a\", _extends({\n    parentName: \"em\"\n  }, {\n    \"href\": \"https://github.com/danielpgross/homekit-ble-temp-humid-sensor/blob/master/sensor/README.md\"\n  }), \"README file in the source code repository\"), \". Please see that file to keep up to date with any changes.\")), mdx(\"p\", null, \"This is firmware code for the nRF52832. To use it, you need to compile it to binary code and then flash it to your device.\"), mdx(\"h4\", null, \"Requirements\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The nRF5 SDK, which provides the necessary compilation resources and tools. Instructions to download it are in step 1 below.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Installation of \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"version 0.5.2\"), \" of \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/NordicSemiconductor/pc-nrfutil\"\n  }), \"Nordic's nrfutil program\"), \". Installation instructions are provided at the source.\")), mdx(\"h4\", null, \"Compilation & flashing\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Download the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developer.nordicsemi.com/nRF5_SDK/nRF5_SDK_v11.x.x/nRF5_SDK_11.0.0_89a8197.zip\"\n  }), \"nRF5 SDK version 11.0.0\"), \".\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"wget https://developer.nordicsemi.com/nRF5_SDK/nRF5_SDK_v11.x.x/nRF5_SDK_11.0.0_89a8197.zip\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Unzip the SDK.\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"unzip nRF5_SDK_11.0.0_89a8197.zip\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Navigate to this path within the unzipped SDK folder: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"examples/ble_peripheral/\"), \".\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"cd nRF5_SDK_11.0.0_89a8197/examples/ble_peripheral/\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"There, copy the entire folder containing this file, with the directory name \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ble_app_temp_humid\"), \".\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"cp -R /path/to/repo/sensor ./ble_app_temp_humid\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Build the code.\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"cd ble_app_temp_humid/wrl13990/s132/armgcc\\nmake\\n\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"You should see build output as follows:\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"rm -rf _build\\necho  Makefile\\nMakefile\\nmkdir _build\\nCompiling file: app_button.c\\nCompiling file: app_error.c\\nCompiling file: app_error_weak.c\\nCompiling file: app_fifo.c\\nCompiling file: app_timer.c\\nCompiling file: app_trace.c\\nCompiling file: app_util_platform.c\\nCompiling file: fstorage.c\\nCompiling file: nrf_assert.c\\nCompiling file: nrf_log.c\\nCompiling file: retarget.c\\nCompiling file: nrf_delay.c\\nCompiling file: nrf_drv_common.c\\nCompiling file: nrf_drv_gpiote.c\\nCompiling file: pstorage.c\\nCompiling file: bsp.c\\nCompiling file: bsp_btn_ble.c\\nCompiling file: main.c\\nCompiling file: dht22.c\\nCompiling file: RTT_Syscalls_GCC.c\\nCompiling file: SEGGER_RTT.c\\nCompiling file: SEGGER_RTT_printf.c\\nCompiling file: ble_advdata.c\\nCompiling file: ble_advertising.c\\nCompiling file: ble_bas.c\\nCompiling file: ble_bps.c\\nCompiling file: ble_conn_params.c\\nCompiling file: ble_dis.c\\nCompiling file: ble_srv_common.c\\nCompiling file: device_manager_peripheral.c\\nCompiling file: system_nrf52.c\\nCompiling file: softdevice_handler.c\\nAssembly file: gcc_startup_nrf52.s\\nLinking target: nrf52832_xxaa_s132.out\\nPreparing: nrf52832_xxaa_s132.bin\\nPreparing: nrf52832_xxaa_s132.hex\\n\\n text      data     bss     dec     hex filename\\n  9332      124     768   10224    27f0 _build/nrf52832_xxaa_s132.out\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Connect the WRL13990 to your computer and begin flashing the compiled firmware. I used the following command to accomplish that using a FT232RL-based USB-to-serial board.\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"nrfutil dfu genpkg --application _build/*.hex pkg.zip && nrfutil dfu serial --package=pkg.zip --port=/dev/cu.usbserial-00000000 --baudrate=38400\\n\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"With the following output.\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"Zip created at pkg.zip\\nUpgrading target on /dev/cu.usbserial-00000000 with DFU package /Users/danielgross/Desktop/ard-temp-sensor/nrf52/nRF5_SDK_11.0.0_89a8197/examples/ble_peripheral/ble_app_temp_humid/wrl13990/s132/armgcc/pkg.zip. Flow control is disabled.\\n  [####################################]  100%          \\nDevice programmed.\\n\")))), mdx(\"h2\", null, \"Bridge module\"), mdx(\"p\", null, \"The bridge module can run on any device capable of Bluetooth and wifi communication, as well as running node.js. The bridge's purpose is to receive the temperature readings broadcast by the sensor module and retransmit those over the HomeKit protocol.\"), mdx(\"h3\", null, \"Implementation discussion\"), mdx(\"h4\", null, \"HomeKit specification\"), mdx(\"p\", null, \"Until earlier this year, the details of the HomeKit specification have been kept private by Apple and only made available to members of the MFi program. Since the MFi program requires submitting an application and paying a membership fee, this information was not available to hobbyists looking to play with HomeKit devices. Fortunately, however, earlier this year Apple made the HomeKit specification available for personal, non-commercial use. The \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developer.apple.com/homekit/specification/\"\n  }), \"HomeKit specification\"), \" can now be accessed for free after creating an Apple Developer account and agreeing to use the documentation only for non-commercial purposes.\"), mdx(\"h4\", null, \"HomeKit framework\"), mdx(\"p\", null, \"As discussed in the first post of this series, I decided to use HAP-NodeJS, a node.js-based implementation of the HomeKit protocol. Since it already implements the details of the HomeKit protocol, implementing our sensor bridge becomes as simple as listening for the BLE broadcasts from the sensor and then calling the appropriate HAP-NodeJS APIs.\"), mdx(\"p\", null, \"HAP-NodeJS is meant to run as a single server instance as opposed to a separate instance for each accessory. Therefore, the accessory code for this module is written to be integrated into a HAP-NodeJS instance as opposed to standing on its own.\"), mdx(\"h4\", null, \"BLE framework\"), mdx(\"p\", null, \"To listen for BLE broadcasts, I used the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/sandeepmistry/noble\"\n  }), mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"noble\"), \" module\"), \", which was the only complete node.js BLE implementation I could find. \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"noble\"), \" is well designed and generally easy to work with, although as of this writing it does not yet support the latest version of macOS.\"), mdx(\"h3\", null, \"Using it yourself\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"The following is copied from the \", mdx(\"a\", _extends({\n    parentName: \"em\"\n  }, {\n    \"href\": \"https://github.com/danielpgross/homekit-ble-temp-humid-sensor/blob/master/bridge/README.md\"\n  }), \"README file in the source code repository\"), \". Please see that file to keep up to date with any changes.\")), mdx(\"p\", null, \"The code is a node.js module that is written to be integrated into an instance of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/KhaosT/HAP-NodeJS\"\n  }), \"HAP-NodeJS\"), \".\"), mdx(\"h4\", null, \"Requirements\"), mdx(\"p\", null, \"The following applications and libraries need to be present in order for this module to work:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"node.js and npm\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Libraries for building HomeKit and Bluetooth components. These can be installed on Ubuntu/Debian using: \"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"apt-get install build-essential python libavahi-compat-libdnssd-dev\\nnpm install -g node-gyp\\n\")))), mdx(\"h4\", null, \"Installation\"), mdx(\"p\", null, \"If you have an instance of HAP-NodeJS, you can skip to step 3.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Install HAP-NodeJS.\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"git clone https://github.com/KhaosT/HAP-NodeJS.git\\ncd HAP-NodeJS\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"(recommended) Remove sample accessories from HAP-NodeJS instance.\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"rm accessories/*_accessory.js\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Copy TempHumidSensor_accessory.js into accessories folder.\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"cp /path/to/repo/bridge/TempHumidSensor_accessory.js accessories/\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Install node modules.\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"npm install\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Manually install the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"noble\"), \" BLE module in the HAP-NodeJS root. This is required for the temperature/humidity accessory.\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"npm install noble\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Finally, start HAP-NodeJS.\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"node Core.js\\n\")))), mdx(\"h2\", null, \"End-to-end demonstration\"), mdx(\"p\", null, \"At last! We've completed building the hardware and software for the project and it's time to see the fruits of our efforts. Once you've followed the instructions in the above sections to get the sensor and bridge modules running, the final step is to complete accessory pairing in the Home app on your iOS device.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Turn on the sensor by connecting it to power.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Activate the bridge module by starting HAP-NodeJS (see above).\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"On your iOS device, open the \\\"Home\\\" app and follow along with the steps below:\")), mdx(PairingGuide, {\n    steps: [{\n      caption: 'Press \"Add Accessory\"',\n      imgUrl: pairing1\n    }, {\n      caption: 'Press \"Temperature Humidity Sensor\"',\n      imgUrl: pairing2\n    }, {\n      caption: 'When prompted, click \"Add Anyway\". Enter the HomeKit Code that\\'s hardcoded, the default is 031-45-154.',\n      imgUrl: pairing3\n    }, {\n      imgUrl: pairing4\n    }, {\n      imgUrl: pairing5\n    }, {\n      caption: 'You should now see 2 new accessories and the humidity and temperature displayed at the top!',\n      imgUrl: pairing6\n    }],\n    mdxType: \"PairingGuide\"\n  }), mdx(\"p\", null, \"Thank you for reading this series of posts!\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"This is the third post in a series about building a simple wireless temperature and humidity sensor using inexpensive components, Bluetoothâ€¦","timeToRead":5,"banner":null}},"pageContext":{"slug":"/blog/ble-homekit-sensor-pt3","formatString":"YYYY-MM-DD"}},"staticQueryHashes":["3090400250","3090400250","318001574"]}