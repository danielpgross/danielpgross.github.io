{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/blog/ble-homekit-sensor-pt2","result":{"data":{"post":{"__typename":"MdxPost","slug":"/blog/ble-homekit-sensor-pt2","title":"Building a battery-powered wireless sensor using Bluetooth Low-Energy (BLE) and Apple HomeKit (Part 2)","date":"2017-07-04","tags":[{"name":"hardware","slug":"hardware"},{"name":"software","slug":"software"},{"name":"internet-of-things","slug":"internet-of-things"},{"name":"bluetooth-low-energy","slug":"bluetooth-low-energy"},{"name":"arduino","slug":"arduino"},{"name":"c","slug":"c"},{"name":"homekit","slug":"homekit"},{"name":"nrf52832","slug":"nrf-52832"}],"description":null,"canonicalUrl":null,"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Building a battery-powered wireless sensor using Bluetooth Low-Energy (BLE) and Apple HomeKit (Part 2)\",\n  \"date\": \"2017-07-04T00:00:00.000Z\",\n  \"tags\": [\"hardware\", \"software\", \"internet-of-things\", \"bluetooth-low-energy\", \"arduino\", \"c\", \"homekit\", \"nrf52832\"],\n  \"slug\": \"/blog/ble-homekit-sensor-pt2\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar StaticImage = makeShortcode(\"StaticImage\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"This is the second post in a series about building a simple wireless temperature and humidity sensor using inexpensive components, Bluetooth Low Energy (BLE) for communication, and Apple HomeKit to read sensor values. For the first post, see \", mdx(\"a\", _extends({\n    parentName: \"em\"\n  }, {\n    \"href\": \"/blog/ble-homekit-sensor-pt1\"\n  }), \"Part 1\")), \".\"), mdx(\"p\", null, \"In the previous post, we covered the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"motivation for this project\"), \" and \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"considered a few high-level designs\"), \", choosing the one that seemed best. Now that we have the main high-level design questions out of the way, let's get into implementation details.\"), mdx(\"h2\", null, \"Hardware selection\"), mdx(\"p\", null, \"Our sensor setup consists of 2 main modules:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"The sensor itself, to be located where temperature and humidity are to be measured.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"An HAP bridge, to be located somewhere within communication range of the sensor (up to ~100m).\")), mdx(\"p\", null, \"Let's take a closer look at the hardware components comprising each of these modules.\"), mdx(\"h3\", null, \"Sensor\"), mdx(\"p\", null, \"The sensor module has 2 main hardware components:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"BLE SoC (System-on-a-chip)\"), \" -- for managing bluetooth communication\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Temperature/Humidity sensor\"), \" -- for (you guessed it!) sensing temperature and humidity\")), mdx(\"h4\", null, \"BLE SoC\"), mdx(\"p\", null, \"In the first post of this series, I explained that I had chosen the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.nordicsemi.com/eng/Products/Bluetooth-low-energy/nRF52832\"\n  }), \"Nordic Semiconductor nRF52832\"), \". This is one amazing little chip -- it packs considerable processing power, with extremely low power requirements, and at a low cost. Here are some of its key specs:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"32-bit ARM Cortex-M4F Processor @ 64MHz\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"1.7v to 3.6v operation\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"512kB flash + 64kB RAM\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"96dBm sensitivity\")), mdx(\"p\", null, \"The nRF52 is available as an IC only for an easy \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.digikey.com/products/en/rf-if-and-rfid/rf-transceiver-ics/879?k=nRF52832\"\n  }), \"$2.50 a piece\"), \" in a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/Quad_Flat_No-leads_package\"\n  }), \"flat no-leads\"), \" package, but for prototyping purposes, you'll want to work with a breakout board. There are a bunch of nRF52 prototyping boards on the market, including the ones below:\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"Manufacturer\"), mdx(\"th\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"Model\"), mdx(\"th\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": \"center\"\n  }), \"Price\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"SparkFun\"), mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), mdx(\"a\", _extends({\n    parentName: \"td\"\n  }, {\n    \"href\": \"https://www.sparkfun.com/products/13990\"\n  }), \"WRL-13990\")), mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": \"center\"\n  }), \"$19.95\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"RedBear\"), mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), mdx(\"a\", _extends({\n    parentName: \"td\"\n  }, {\n    \"href\": \"https://redbear.cc/product/ble-nano-2.html\"\n  }), \"BLE Nano v2\")), mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": \"center\"\n  }), \"$16.90\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"Nordic\"), mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), mdx(\"a\", _extends({\n    parentName: \"td\"\n  }, {\n    \"href\": \"https://www.nordicsemi.com/eng/Products/Bluetooth-low-energy/nRF52-DK\"\n  }), \"nRF52 DK (development kit)\")), mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": \"center\"\n  }), \"$39.00\")))), mdx(\"p\", null, \"I chose the SparkFun WRL-13990, for a few reasons:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It has \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://learn.sparkfun.com/tutorials/nrf52832-breakout-board-hookup-guide?_ga=2.249486336.665477030.1498608245-1887958815.1498608245\"\n  }), \"solid, easy-to-read documentation\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It comes pre-programmed with a serial bootloader. That means that it can be programmed using a simple USB-to-serial converter instead of a more complex and expensive JTAG programmer. It also has its pins arranged so that it can be easily attached to such a USB-to-serial programmer.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It's compatible with the Arduino IDE. \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"This adds the huge benefit that existing Arduino libraries and samples can run on the chip.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It's relatively inexpensive\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It has LEDs and buttons for easy debugging\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It has a small form factor (especially in comparison to the nRF52 DK)\")), mdx(\"p\", null, \"I predicted that programming the nRF5 would be one of the most challenging parts of the project, and I chose the WRL-13990 in hopes that it would greatly simplify this process.\"), mdx(\"p\", null, \"One important note about the WRL-13990 is that it comes \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"without headers attached\"), \". In order to use it in this project, \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"the headers need to be soldered on\"), \", which requires basic soldering tools and skills. If this is a dealbreaker for you, you might want to consider another board instead.\"), mdx(\"h4\", null, \"Temperature/Humidity sensor\"), mdx(\"p\", null, \"I chose a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.adafruit.com/product/385\"\n  }), \"DHT-22\"), \" temperature/humidity sensor because it has extremely wide support, discussion, and documentation within the Arduino community. I chose it over the lower-cost \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.adafruit.com/product/386\"\n  }), \"DHT-11\"), \" because of its higher sensor-reading precision.\"), mdx(\"h4\", null, \"USB-to-serial programmer\"), mdx(\"p\", null, \"Although strictly speaking it's not part of the sensor, a USB-to-serial (sometimes called USB-to-TTL) programmer chip is needed to program software into the nRF52. USB-to-serial chips are very cheap and easily available, with a few ICs forming the core of different PCB variations in the market. I chose an \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://www.ebay.ca/itm/FT232RL-3-3V-5-5V-FTDI-USB-to-TTL-Serial-Adapter-Module-for-Arduino-Mini-Port-/162385456286?hash=item25ceed6c9e:g:g8cAAOSwNnRYl~eJ\"\n  }), \"FTDI FT232RL-based board\"), \" that I found listed on eBay for a few dollars. \"), mdx(\"h3\", null, \"HAP bridge\"), mdx(\"p\", null, \"For the bridge, we have the following basic requirements:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Capable of BLE communication\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Capable of Wi-Fi communication\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Capable of running the node.js-based bridge server software\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Low power requirements (preferably)\")), mdx(\"p\", null, \"Our computational resource requirements are very low, since the bridge will only serve to periodically relay readings from the sensor to HomeKit devices. This leaves us with many options, including most modern laptops and low-cost single-board computers like the Raspberry Pi. The operating system does not matter much, as long as it's capable of running node.js.\"), mdx(\"p\", null, \"My choice for this module was a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://getchip.com/pages/chip\"\n  }), \"C.H.I.P. Computer\"), \" that I have lying around and that I've been waiting to put to good use.\"), mdx(\"h2\", null, \"Hardware assembly\"), mdx(\"p\", null, \"Having discussed all the major hardware components to be used for the sensor, let's dive into assembling it!\"), mdx(\"h3\", null, \"Parts list\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"These parts are available from different suppliers; I suggest googling the model number to see which suppliers are available and which is best for you.\")), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"WRL-13990\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"DHT-22\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Breadboard (small, I used 30 columns by A-J rows)\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Jumper wires, male-male \", \"\\xD7\", \" 3\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Jumper wires, female-female \", \"\\xD7\", \" 6\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"FTDI FT232RL-based USB-to-serial board and mini-USB-to-USB cable\")), mdx(\"h3\", null, \"Diagram\"), mdx(StaticImage, {\n    layout: \"fluid\",\n    maxWidth: 400,\n    src: \"sensor_diagram.png\",\n    mdxType: \"StaticImage\"\n  }), mdx(\"h3\", null, \"Assembly instructions\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Complete the procedure described in the \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://learn.sparkfun.com/tutorials/nrf52832-breakout-board-hookup-guide\"\n  }), \"WRL-13990 Hookup Guide\"), \" (most importantly, solder the headers onto the WRL-13990).\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Insert the WRL-13990 into the breadboard as shown in the diagram.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Insert the DHT-22 into the breadboard as shown in the diagram.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Connect the DHT-22 to the WRL-13990 using 3 male-to-male jumper wires, as shown in the diagram.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Connect the WRL-13990 to the USB-to-serial chip using the 6 female-to-female jumper wires, as explained in the Hookup Guide from step 1.\")), mdx(\"h3\", null, \"Photos\"), mdx(\"p\", null, \"Once assembled, our sensor (with attached USB-to-serial programmer) looks like this:\\n\", mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"75%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFAf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFByY/LMND/xAAaEAEBAAMBAQAAAAAAAAAAAAABAgAEEQMS/9oACAEBAAEFAvOBb13icZtnHaMqvqv/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAACAQUAAAAAAAAAAAAAAAAAARECEDNRof/aAAgBAQAGPwJLZCpRFsfRs//EABsQAAIDAAMAAAAAAAAAAAAAAAABESExQVGR/9oACAEBAAE/IdAOxeI+5HvbU4GGj3D0VDEs/9oADAMBAAIAAwAAABAkL//EABYRAQEBAAAAAAAAAAAAAAAAAAEAIf/aAAgBAwEBPxASy//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQEAAgIDAAAAAAAAAAAAAAERACExQVFhcf/aAAgBAQABPxCcg2ywMG101rny84Z8cg8mSwiOzEVvebl2ITDr1n//2Q==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"sensor photo 1\",\n    \"title\": \"sensor photo 1\",\n    \"src\": \"/static/781ecc2c23fd3c2d2ce085e273db1c95/18e3b/sensor_photo_1.jpg\",\n    \"srcSet\": [\"/static/781ecc2c23fd3c2d2ce085e273db1c95/46946/sensor_photo_1.jpg 240w\", \"/static/781ecc2c23fd3c2d2ce085e273db1c95/55489/sensor_photo_1.jpg 480w\", \"/static/781ecc2c23fd3c2d2ce085e273db1c95/18e3b/sensor_photo_1.jpg 960w\", \"/static/781ecc2c23fd3c2d2ce085e273db1c95/60e21/sensor_photo_1.jpg 1440w\", \"/static/781ecc2c23fd3c2d2ce085e273db1c95/69b48/sensor_photo_1.jpg 1920w\", \"/static/781ecc2c23fd3c2d2ce085e273db1c95/714ef/sensor_photo_1.jpg 3264w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"75%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAZ1IpGE0J//EABsQAAIDAAMAAAAAAAAAAAAAAAECAwQSABEh/9oACAEBAAEFAo64K2I0RyCOLnOR03p//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHhAAAQMEAwAAAAAAAAAAAAAAAAEhMRARMkFRkaH/2gAIAQEABj8CSOyycaGIcx9p/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARITFRYXH/2gAIAQEAAT8hUnb3Ae5KNxyhp0jyV7mN19i1rP/aAAwDAQACAAMAAAAQd8//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPxBn/8QAFREBAQAAAAAAAAAAAAAAAAAAECH/2gAIAQIBAT8Qp//EAB0QAQEAAgIDAQAAAAAAAAAAAAERACFhkTFBcbH/2gAIAQEAAT8Qd6Mb4LwOLjuAHb9xMElQZTGXfpeusZWwcHWVFr+Z/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"sensor photo 2\",\n    \"title\": \"sensor photo 2\",\n    \"src\": \"/static/19a6b71dff8a49c38ddbbd1eae7e7485/18e3b/sensor_photo_2.jpg\",\n    \"srcSet\": [\"/static/19a6b71dff8a49c38ddbbd1eae7e7485/46946/sensor_photo_2.jpg 240w\", \"/static/19a6b71dff8a49c38ddbbd1eae7e7485/55489/sensor_photo_2.jpg 480w\", \"/static/19a6b71dff8a49c38ddbbd1eae7e7485/18e3b/sensor_photo_2.jpg 960w\", \"/static/19a6b71dff8a49c38ddbbd1eae7e7485/60e21/sensor_photo_2.jpg 1440w\", \"/static/19a6b71dff8a49c38ddbbd1eae7e7485/69b48/sensor_photo_2.jpg 1920w\", \"/static/19a6b71dff8a49c38ddbbd1eae7e7485/714ef/sensor_photo_2.jpg 3264w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"h2\", null, \"Software architecture and data flow\"), mdx(\"p\", null, \"Now that we've assembled the sensor, we need to program it. In the next post, we'll look at the sensor's software in detail. Here, let's look at the required software functionality from a high level.\"), mdx(\"p\", null, \"The basic data flow is as follows:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"The sensor periodically broadcasts its readings over BLE. \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"(sensor module)\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"The HAP bridge listens for the sensor's BLE broadcasts, repeatedly storing the last received value. \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"(bridge module)\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"After receiving a new BLE broadcast, the HAP bridge broadcasts the new sensor reading value over HAP via Wi-Fi to paired HAP devices. \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"(bridge module)\"))), mdx(\"h3\", null, \"Sensor module\"), mdx(\"p\", null, \"As discussed in the previous post, I aimed to keep the sensor's role as simple as possible in order to achieve low power consumption (and thus long battery life). The \\\"dumb\\\" sensor's only task is to indefinitely broadcast sensor readings out over BLE; all HAP functionality is offloaded to the bridge.\"), mdx(\"p\", null, \"The sensor module will utilize \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.nordicsemi.com/eng/Products/Bluetooth-low-energy/nRF5-SDK\"\n  }), \"Nordic's nRF5 SDK\"), \" to interface with the SoC hardware. It will also be necessary to interface with the DHT-22 in order to read measurements from it.\"), mdx(\"h3\", null, \"Bridge module\"), mdx(\"p\", null, \"As explained in the previous post, the bridge will use \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/KhaosT/HAP-NodeJS\"\n  }), \"HAP-NodeJS\"), \" to abstract away the details of HAP communication, including device pairing and sensor value communication. The bridge will also utilize a node.js BLE library in order to receive BLE communications from the sensor.\"), mdx(\"h3\", null, \"Diagram\"), mdx(\"p\", null, \"Here's a block diagram showing our software architecture. Our custom-written modules are shown in white, while third party modules are shaded.\"), mdx(\"img\", {\n    src: software_arch\n  }), mdx(\"h2\", null, \"Conclusion and next steps\"), mdx(\"p\", null, \"Now that we've looked at hardware assembly and high-level data flow, we're ready to get into the software implementation details. In the next post, we'll look at the software code necessary to make our sensor work.\"), mdx(\"h5\", null, \"On to \", mdx(\"a\", _extends({\n    parentName: \"h5\"\n  }, {\n    \"href\": \"/blog/ble-homekit-sensor-pt3\"\n  }), \"Part 3\"), \"!\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"This is the second post in a series about building a simple wireless temperature and humidity sensor using inexpensive components, Bluetooth…","timeToRead":4,"banner":null}},"pageContext":{"slug":"/blog/ble-homekit-sensor-pt2","formatString":"YYYY-MM-DD"}},"staticQueryHashes":["3090400250","3090400250","318001574"]}